import{Q as B,a as T,b as V,c as U}from"./QTabPanels-DLo1luf3.js";import{a3 as O,r as f,b as _,a4 as L,a6 as o,a7 as y,a8 as i,a9 as l,ac as u,al as M,A as N,ak as n,am as E,aa as j,ab as $,aj as g,ad as d,ah as C,ag as F,an as I,Q as G,bk as R}from"./index-De74Ka4-.js";import{Q as P}from"./QImg-CcLeZTMI.js";import{Q as X}from"./QPage-CU-ijYm-.js";import{g as H,s as J,r as K}from"./index.esm2017-B9JF2wk_.js";import{u as W}from"./use-quasar-CS3Jvdc-.js";import"./touch-DhFK--XS.js";import"./rtl-DFPa-2ov.js";import"./selection-9b_hriWF.js";import"./index.esm2017-DZ21P5YZ.js";const Y=H(),Z=O({name:"GalleryPage",props:{cards:{type:Array,default:()=>[]},user:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["earn-xp"],setup(e,{emit:s}){const b=W(),v=f(""),w=f("quiz"),Q=r=>e.users.find(k=>k.uid===r)?.photoURL||"https://cdn.quasar.dev/img/boy-avatar.png",a=f({image:"https://via.placeholder.com/150",options:["選項1","選項2","選項3","選項4"],answer:"選項1"}),c=_(()=>{if(!v.value)return e.cards;const r=v.value.toLowerCase();return e.cards.filter(t=>t.description.toLowerCase().includes(r))}),m=r=>{if(r){const t=new SpeechSynthesisUtterance(r);t.lang="en-US",t.rate=.6,window.speechSynthesis.speak(t)}},D=r=>{if(window.confirm("確定要刪除這張卡片嗎？此動作無法復原。")){const t=e.cards.filter((k,A)=>A!==r);J(K(Y,"cards"),t)}},h=f(""),p=f(0),S=()=>{h.value===a.value.answer?(p.value++,s("earn-xp",p.value*100),b.notify({type:"positive",message:"答對了！您已連續答對 "+p.value+" 題，得到 "+p.value*100+"XP",position:"top",timeout:1500}),z()):(p.value=0,b.notify({type:"negative",message:"答錯了！再試一次",position:"top",timeout:1500}))},z=()=>{if(!e.cards.length)return;const r=Math.floor(Math.random()*e.cards.length),t=e.cards[r];a.value.image=t.image,a.value.answer=t.description,h.value="";const A=e.cards.filter(q=>q.description!==t.description).sort(()=>Math.random()-.5).slice(0,3);a.value.options=[t.description,...A.map(q=>q.description)].sort(()=>Math.random()-.5)};return{getPhotoById:Q,playCardAudio:m,deleteCard:D,searchQuery:v,filteredCards:c,quiz:a,selectedOption:h,checkAnswer:S,wins:p,tab:w,makeQuiz:z}}}),x={class:"word-card-list"},ee={class:"search-bar q-mb-md"},ae={class:"gallery-grid q-mt-lg flex flex-row-reverse flex-wrap-reverse"},se={class:"text-body1"},le={class:"row q-mt-sm justify-between"},oe={key:0,class:"text-body2"},te=["src"],re={key:1,class:"text-body2"},ue={class:"word-card-list"},ie={class:"quiz-container"},ne={key:0,class:"quiz-question"},de={key:0},ce={key:2,class:"quiz-options"};function me(e,s,b,v,w,Q){return o(),y(X,{class:"q-pa-md"},{default:i(()=>[l(T,{modelValue:e.tab,"onUpdate:modelValue":s[0]||(s[0]=a=>e.tab=a),class:"text-grey"},{default:i(()=>[l(B,{name:"gallery",label:"AI 圖片描述畫廊"}),l(B,{name:"quiz",label:"4選1小測驗"})]),_:1},8,["modelValue"]),l(U,{modelValue:e.tab,"onUpdate:modelValue":s[4]||(s[4]=a=>e.tab=a),animated:""},{default:i(()=>[l(V,{name:"gallery"},{default:i(()=>[u("div",x,[s[6]||(s[6]=u("h1",null,"AI 圖片描述畫廊",-1)),u("div",ee,[l(M,{modelValue:e.searchQuery,"onUpdate:modelValue":s[1]||(s[1]=a=>e.searchQuery=a),outlined:"",dense:"",placeholder:"搜尋圖片描述...",class:"search-input",clearable:""},{append:i(()=>[l(N,{name:"search"})]),_:1},8,["modelValue"])]),u("div",ae,[(o(!0),n(I,null,E(e.filteredCards,(a,c)=>(o(),y(j,{key:c,class:"gallery-card q-ma-sm",flat:"",bordered:""},{default:i(()=>[l(P,{src:a.image,ratio:1,class:"gallery-image"},null,8,["src"]),l($,null,{default:i(()=>[u("div",se,g(a.description),1),u("div",le,[l(d,{color:"primary",icon:"volume_up",label:"播放發音",onClick:m=>e.playCardAudio(a.description),flat:""},null,8,["onClick"]),e.user&&e.user.isAdmin?(o(),y(d,{key:0,color:"negative",icon:"delete",label:"刪除",onClick:m=>e.deleteCard(c),flat:""},null,8,["onClick"])):C("",!0)])]),_:2},1024),l($,null,{default:i(()=>[e.user&&e.user.isAdmin?(o(),n("div",oe,[s[5]||(s[5]=F(" upload by ")),u("img",{src:e.getPhotoById(a.createdBy||"未知"),class:"avatar"},null,8,te),F(" "+g((a.createdAt||"未知").split("T")[0]),1)])):(o(),n("div",re," upload at "+g((a.createdAt||"未知").split("T")[0]),1))]),_:2},1024)]),_:2},1024))),128))])])]),_:1}),l(V,{name:"quiz"},{default:i(()=>[u("div",ue,[u("div",ie,[e.quiz.image!=="https://via.placeholder.com/150"?(o(),n("div",ne,[u("h2",null,[s[7]||(s[7]=F(" 這是什麼？")),e.wins>0?(o(),n("span",de," - 您已連續答對 "+g(e.wins)+" 題",1)):C("",!0)]),l(P,{src:e.quiz.image,ratio:1,class:"quiz-image"},null,8,["src"]),l(d,{color:"primary",icon:"volume_up",label:"播放發音",onClick:s[2]||(s[2]=a=>e.playCardAudio(e.quiz.answer)),flat:""})])):C("",!0),e.quiz.image!=="https://via.placeholder.com/150"?(o(),y(G,{key:1})):C("",!0),e.quiz.image!=="https://via.placeholder.com/150"?(o(),n("div",ce,[(o(!0),n(I,null,E(e.quiz.options,(a,c)=>(o(),n("div",{key:c,class:"quiz-option"},[l(R,{modelValue:e.selectedOption,"onUpdate:modelValue":s[3]||(s[3]=m=>e.selectedOption=m),val:a,label:a},null,8,["modelValue","val","label"]),l(d,{color:"primary",icon:"volume_up",label:"播放發音",onClick:m=>e.playCardAudio(a),flat:""},null,8,["onClick"])]))),128)),l(d,{color:"primary",icon:"check",label:"檢查答案",onClick:e.checkAnswer},null,8,["onClick"])])):C("",!0),e.quiz.image=="https://via.placeholder.com/150"?(o(),y(d,{key:3,color:"primary",size:"xl",icon:"refresh",label:"開始出題！",onClick:e.makeQuiz},null,8,["onClick"])):(o(),y(d,{key:4,color:"primary",icon:"refresh",label:"重新出題！",onClick:e.makeQuiz,flat:""},null,8,["onClick"]))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const qe=L(Z,[["render",me],["__scopeId","data-v-dedb2e53"],["__file","GalleryPage.vue"]]);export{qe as default};
