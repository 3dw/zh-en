import{N as I,r as d,K as L,_ as R,P as h,R as A,S as s,V as r,U as a,Q as E,X as v,ag as z,ah as U,ai as F,$ as p,W as k,a0 as w,a2 as G,a1 as J,Y as V}from"./index-De6PsxQc.js";import{Q as M}from"./QInput-CjiMuyjo.js";import{Q as q,b as $,a as P}from"./QItem-CJ1TSh1x.js";import{u as K,Q as W,a as j}from"./use-quasar-BnGh-wcc.js";import{Q as N}from"./QCard-DbZornLG.js";import{Q as X}from"./QImg-BBvXrOjH.js";import{Q as Y}from"./QLinearProgress-B_vnSREF.js";import{Q as H}from"./QCardSection-wrS3ymTz.js";import{Q as Z}from"./QDialog-CdBsviDf.js";import{Q as x}from"./QPage-Ns1DEP4R.js";import"./use-file-dom-props-u75DCdGV.js";import"./use-id-4S4WTWnM.js";import"./use-dark-Bm04ldpC.js";import"./focus-manager-DhdJisJs.js";import"./QChip-DpMjZvr-.js";import"./position-engine-Dg0bLx9c.js";import"./selection-DkjDpLRp.js";import"./use-timeout-_n3ozNLG.js";import"./format-CJebrXOQ.js";const ee=I({name:"StoryPageBackend",emits:["closeLeftDrawer"],setup(o,{emit:t}){const c=K(),S=d(!1),g=L({childName:"",ageGroup:"",storyType:""}),B=d(!1),e=d("正在生成故事..."),l=d(null),y=d([]),C=d([]),m=d([]),D=d(null),O=d(null);return{formData:g,loading:S,showProgress:B,progressMessage:e,generatedStory:l,storyParagraphs:y,paragraphImages:C,translatedParagraphs:m,audioPlayer:D,storySection:O,printStory:()=>{console.log("列印故事"),l.value?(t("closeLeftDrawer"),setTimeout(()=>{window.print()},1e3)):c.notify({type:"negative",message:"故事尚未生成"})},generateStory:async()=>{try{S.value=!0,B.value=!0,y.value=[],C.value=[],m.value=[],l.value=null,e.value="正在創作故事...";const n=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({childName:g.childName,ageGroup:g.ageGroup,storyType:g.storyType,step:1})});if(!n.ok)throw new Error("故事生成失敗");const f=await n.json();if(!f.success)throw new Error(f.error||"故事生成失敗");y.value=f.content.split(`

`).filter(i=>i.trim());for(let i=0;i<y.value.length;i++){e.value=`正在翻譯...${i+1}/${y.value.length}`;const Q=y.value[i],T=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:Q})})).text();m.value.push(T)}for(let i=0;i<m.value.length;i++){const Q=m.value[i];e.value=`正在生成配圖...${i+1}/${m.value.length}`;const _=await fetch("https://zh-en-backend.alearn13994229.workers.dev/generate-image-by-single-paragraph",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyParagraph:Q})});if(!_.ok)throw new Error("圖片生成失敗");const T=await _.json();C.value.push(T.image)}e.value="正在生成語音...";const b=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({step:3,content:m.value.join()})});if(!b.ok)throw new Error("語音生成失敗");const u=await b.json();if(!u.success)throw new Error(u.error||"語音生成失敗");l.value={content:f.content,audioUrl:u.audioUrl},setTimeout(()=>{D.value&&D.value.play(),O.value?.scrollIntoView({behavior:"smooth",block:"start"})},1e3),c.notify({type:"positive",message:"故事生成完成！",position:"top"})}catch(n){c.notify({type:"negative",message:`發生錯誤：${n instanceof Error?n.message:"請稍後重試"}`,position:"top"}),console.error("生成故事時發生錯誤：",n)}finally{S.value=!1,B.value=!1}},audioEnded:()=>{console.log("音頻播放結束")},downloadAudio:async()=>{try{if(!l.value?.audioUrl)throw new Error("找不到音頻檔案");const f=await(await fetch(l.value.audioUrl)).blob(),b=window.URL.createObjectURL(f),u=document.createElement("a");u.href=b,u.download=`${g.childName}的故事.mp3`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(b),document.body.removeChild(u),c.notify({type:"positive",message:"音頻檔案下載成功！",position:"top"})}catch(n){c.notify({type:"negative",message:`下載失敗：${n instanceof Error?n.message:"請稍後重試"}`,position:"top"}),console.error("下載音頻時發生錯誤：",n)}},ageOptions:[{label:"2-4歲 (學前)",value:"2-4",description:"簡單有趣的故事，適合幼兒園前的寶寶"},{label:"5-7歲 (幼兒園)",value:"5-7",description:"包含基礎生活詞彙的故事"},{label:"8-10歲 (小學)",value:"8-10",description:"較長的故事，豐富的詞彙和情節"},{label:"10+歲 (小學高年級以上)",value:"10+",description:"更長的故事，更豐富的詞彙和情節"}],storyTypeOptions:[{label:"冒險故事",value:"adventure",description:"充滿刺激和挑戰的冒險故事"},{label:"童話故事",value:"fairy_tale",description:"充滿魔法和想像力的奇幻故事"},{label:"教育故事",value:"educational",description:"包含生活教育意義的啟發性故事"},{label:"動物故事",value:"animal",description:"以可愛動物為主角的溫馨故事"},{label:"科幻故事",value:"sci_fi",description:"激發想像力的科學幻想故事"}]}}}),oe={class:"story-container"},ae={class:"hero-title"},te={class:"content-wrapper"},se={class:"form-wrapper"},re={class:"input-group"},le={class:"input-group"},ne={class:"input-group"},ie={class:"row justify-center q-mt-lg"},ue={key:0,ref:"storySection",class:"story-section q-mt-xl"},de={class:"story-title q-mb-lg"},pe={class:"story-content col-12 col-md-7"},me={class:"text-body1"},ce={class:"text-body1"},ge={key:0,class:"story-image col-12 col-md-5"},ye={key:0,class:"audio-player"},fe=["src"],he={class:"row justify-end q-mt-md"},ve={class:"q-ml-sm"};function be(o,t,c,S,g,B){return h(),A(x,{class:"story-page-backend"},{default:s(()=>[r("div",oe,[r("h2",ae,[a(E,{name:"auto_stories",size:"md",color:"primary",class:"q-mr-sm"}),t[5]||(t[5]=v(" Create ")),t[6]||(t[6]=r("span",{class:"highlight"},"Bedtime Stories",-1)),t[7]||(t[7]=r("div",{class:"subtitle"},"創造獨特的英文睡前故事",-1))]),r("div",te,[r("div",se,[a(N,{class:"form-card q-pa-xl"},{default:s(()=>[a(W,{onSubmit:z(o.generateStory,["prevent"]),class:"q-gutter-md"},{default:s(()=>[r("div",re,[a(M,{modelValue:o.formData.childName,"onUpdate:modelValue":t[0]||(t[0]=e=>o.formData.childName=e),outlined:"",label:"孩子的名字",rules:[e=>!!e||"請輸入名字",e=>e.length<=20||"名字不能超過20個字符"]},{prepend:s(()=>[a(E,{name:"person"})]),hint:s(()=>t[8]||(t[8]=[v(" 可以輸入中文或英文名字 ")])),_:1},8,["modelValue","rules"])]),r("div",le,[a(j,{modelValue:o.formData.ageGroup,"onUpdate:modelValue":t[1]||(t[1]=e=>o.formData.ageGroup=e),options:o.ageOptions,outlined:"",label:"年齡段","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇年齡段"]},{prepend:s(()=>[a(E,{name:"child_care"})]),option:s(e=>[a(q,U(F(e.itemProps)),{default:s(()=>[a($,null,{default:s(()=>[a(P,null,{default:s(()=>[v(p(e.opt.label),1)]),_:2},1024),a(P,{caption:""},{default:s(()=>[v(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",ne,[a(j,{modelValue:o.formData.storyType,"onUpdate:modelValue":t[2]||(t[2]=e=>o.formData.storyType=e),options:o.storyTypeOptions,outlined:"",label:"故事類型","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇故事類型"]},{prepend:s(()=>[a(E,{name:"auto_stories"})]),option:s(e=>[a(q,U(F(e.itemProps)),{default:s(()=>[a($,null,{default:s(()=>[a(P,null,{default:s(()=>[v(p(e.opt.label),1)]),_:2},1024),a(P,{caption:""},{default:s(()=>[v(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",ie,[a(k,{type:"submit",color:"primary",label:"開始創建故事",loading:o.loading,class:"submit-btn"},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),t[9]||(t[9]=r("div",{class:"tiger-image"},[r("img",{src:"/images/tiger.png",alt:"Storyteller Tiger"})],-1))])]),o.generatedStory?(h(),w("div",ue,[a(N,{class:"story-card q-pa-lg"},{default:s(()=>[r("h3",de,p(o.formData.childName)+" 的故事",1),(h(!0),w(G,null,J(o.storyParagraphs,(e,l)=>(h(),w("div",{key:l,class:"paragraph-section q-mb-xl row items-start q-col-gutter-lg"},[r("div",pe,[r("p",me,p(o.translatedParagraphs[l]),1),r("p",ce,p(e),1)]),o.paragraphImages[l]?(h(),w("div",ge,[a(X,{src:o.paragraphImages[l],"spinner-color":"primary",style:{"border-radius":"12px","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},null,8,["src"])])):V("",!0)]))),128)),o.generatedStory.audioUrl?(h(),w("div",ye,[r("audio",{ref:"audioPlayer",src:o.generatedStory.audioUrl,controls:"",class:"full-width",onEnded:t[3]||(t[3]=(...e)=>o.audioEnded&&o.audioEnded(...e))},null,40,fe)])):V("",!0),r("div",he,[a(k,{flat:"",color:"primary",label:"下載語音",disable:o.loading||!o.generatedStory?.audioUrl,onClick:o.downloadAudio,icon:"download"},null,8,["disable","onClick"]),a(k,{flat:"",color:"primary",label:"列印故事",disable:o.loading,onClick:o.printStory,icon:"print"},null,8,["disable","onClick"]),a(k,{flat:"",color:"primary",label:"重新生成",disable:o.loading,onClick:o.generateStory,icon:"refresh"},null,8,["disable","onClick"])])]),_:1})],512)):V("",!0),a(Z,{modelValue:o.showProgress,"onUpdate:modelValue":t[4]||(t[4]=e=>o.showProgress=e),persistent:""},{default:s(()=>[a(N,{style:{"min-width":"300px"}},{default:s(()=>[a(H,{class:"row items-center"},{default:s(()=>[r("span",ve,p(o.progressMessage),1),a(Y,{indeterminate:"",class:"q-mt-md",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Je=R(ee,[["render",be],["__file","StoryPage_backend.vue"]]);export{Je as default};
