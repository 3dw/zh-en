import{c as A,b as E,h as k,d as C,j,N as O,r as u,_ as V,P as l,R,S as m,V as i,U as r,Q as F,X as q,a0 as p,$ as w,Y as b,W as Q,a2 as I,a1 as U,Z as J}from"./index-DjPobmbs.js";import{Q as P}from"./QSpinnerDots-GG8HXtlK.js";import{u as L,a as M}from"./use-dark-Dqa76tW0.js";import{Q as Z}from"./QLinearProgress-C-QgQ0Qp.js";import{Q as W}from"./QInput-BeFq4QDw.js";import{Q as D}from"./QCardSection-C-R88YBs.js";import{Q as z}from"./QCard-DD8VmbjP.js";import{Q as X}from"./QImg-C0UYvVKr.js";import{Q as Y}from"./QPage-B26RM9U6.js";import"./use-file-dom-props-PR1H5nra.js";import"./use-id-DMIPX0cB.js";import"./focus-manager-DhdJisJs.js";import"./use-timeout-DLbppMCe.js";const G=A({name:"QBanner",props:{...L,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(e,{slots:a}){const{proxy:{$q:f}}=j(),h=M(e,f),c=E(()=>"q-banner row items-center"+(e.dense===!0?" q-banner--dense":"")+(h.value===!0?" q-banner--dark q-dark":"")+(e.rounded===!0?" rounded-borders":"")),y=E(()=>`q-banner__actions row items-center justify-end col-${e.inlineActions===!0?"auto":"all"}`);return()=>{const s=[k("div",{class:"q-banner__avatar col-auto row items-center self-start"},C(a.avatar)),k("div",{class:"q-banner__content col text-body2"},C(a.default))],d=C(a.action);return d!==void 0&&s.push(k("div",{class:y.value},d)),k("div",{class:c.value+(e.inlineActions===!1&&d!==void 0?" q-banner--top-padding":""),role:"alert"},s)}}}),H=O({name:"PlaybackPage",setup(){const e=u(""),a=u(""),f=u([]),h=u(!1),c=u(""),y=u(!1),s=u(""),d=async o=>{s.value="正在翻譯故事內容...";const t=await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-en-to-zh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})});if(!t.ok)throw new Error("翻譯失敗");const n=await t.text();return console.log("第一步驟翻譯內容為中文data",n),a.value=n,n},S=async o=>{s.value="正在分析故事情緒...";const t=await fetch("https://zh-en-backend.alearn13994229.workers.dev/emotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})});if(!t.ok)throw new Error("情緒分析失敗");console.log("第二步驟情緒分析結果response",t);const n=await t.json();return console.log("第二步驟情緒分析結果data",n),{emotions:(n.emotions||[]).map(v=>({name:v.split(":")[0].trim().replace(/^\d+\./,"")}))}},B=async(o,t)=>{s.value=`正在生成 ${t} 的情緒圖片...`,console.log("生成圖片的情緒數據:",t);const n=await fetch("https://zh-en-backend.alearn13994229.workers.dev/playback/image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story:o,emotion:t})});if(!n.ok)throw new Error("圖片生成失敗");const g=await n.json();return console.log("生成的圖片結果:",g),g},T=async o=>{s.value=`正在翻譯 ${o} 的英文說明...`;const t=await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:`這個情緒是${o}`})});if(!t.ok)throw new Error("情緒翻譯失敗");const n=await t.text();return console.log(`${o} 的英文翻譯:`,n),n},$=o=>{speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(o.enName);t.lang="en-US",t.rate=.8,speechSynthesis.speak(t)},N=async o=>{f.value=o.map(t=>({...t,showContent:!0,moveStep:0}))};return{userStory:e,translatedStory:a,emotions:f,loading:h,error:c,showProgress:y,progressMessage:s,analyzeEmotion:async()=>{if(!e.value.trim()){c.value="請輸入故事內容";return}h.value=!0,y.value=!0,c.value="";try{const o=e.value.trim(),t=await d(o);a.value=t;const n=await S(t),g=[];for(const v of n.emotions){const _=await B(t,v.name);if(!_.images||!Array.isArray(_.images))throw new Error(`${v.name} 的圖片生成結果格式不正確`);const x=await T(v.name);g.push({name:v.name,enName:x,imageUrl:_.images[0]||"",isAnimating:!1,showContent:!1,moveStep:0})}await N(g)}catch(o){console.error("分析錯誤:",o),c.value=o instanceof Error?o.message:"分析過程發生錯誤，請稍後再試"}finally{h.value=!1,y.value=!1,s.value=""}},speakEmotion:$}}}),K={class:"row items-center q-mb-md"},ee={class:"col"},te={key:0,class:"loading-section"},se={class:"text-subtitle1 q-mt-md"},oe={key:1,class:"error-section"},ae={key:2,class:"progress-section"},ne={class:"text-subtitle1 text-center"},re={class:"row q-col-gutter-md"},ie={class:"col-12 col-md-6"},le={class:"text-center"},ce={key:0,class:"col-12 col-md-6"},de={class:"emotion-grid"},ue={key:0,class:"emotion-content"},me={class:"text-subtitle1 q-mt-sm"};function pe(e,a,f,h,c,y){return l(),R(Y,{class:"q-pa-md"},{default:m(()=>[i("div",K,[i("h1",ee,[r(F,{name:"psychology",size:"md",color:"primary",class:"q-mr-sm"}),a[1]||(a[1]=q(" 今日回顧 | Daily Reflection "))])]),e.loading?(l(),p("div",te,[r(P,{color:"primary",size:"3em"}),i("p",se,w(e.progressMessage),1)])):b("",!0),e.error?(l(),p("div",oe,[r(G,{class:"bg-negative text-white"},{default:m(()=>[q(w(e.error),1)]),_:1})])):b("",!0),e.showProgress?(l(),p("div",ae,[r(Z,{indeterminate:"",rounded:"",size:"md",color:"primary",class:"q-mb-sm"}),i("div",ne,w(e.progressMessage),1)])):b("",!0),i("div",re,[i("div",ie,[r(z,{class:"rpg-card"},{default:m(()=>[r(D,null,{default:m(()=>[a[2]||(a[2]=i("div",{class:"text-h6 q-mb-md"},"分享今天最深刻的經歷",-1)),r(W,{modelValue:e.userStory,"onUpdate:modelValue":a[0]||(a[0]=s=>e.userStory=s),type:"textarea",rows:"6",outlined:"",placeholder:`請用英文或中文描述...
Please describe in English or Chinese...`,class:"q-mb-md"},null,8,["modelValue"]),i("div",le,[r(Q,{color:"primary",label:"分析情緒",loading:e.loading,onClick:e.analyzeEmotion,class:"rpg-button"},{loading:m(()=>[r(P)]),_:1},8,["loading","onClick"])])]),_:1})]),_:1})]),e.emotions.length>0?(l(),p("div",ce,[r(z,{class:"rpg-card"},{default:m(()=>[r(D,null,{default:m(()=>[a[3]||(a[3]=i("div",{class:"text-h6 q-mb-md"},"情緒分析結果",-1)),i("div",de,[(l(!0),p(I,null,U(e.emotions,(s,d)=>(l(),p("div",{key:d,class:J(["emotion-item",{"move-step-1":s.moveStep===1,"move-step-2":s.moveStep===2,"show-content":s.showContent}])},[r(X,{src:s.imageUrl,"spinner-color":"primary",style:{height:"200px","max-width":"200px"},class:"rounded-borders"},null,8,["src"]),s.showContent?(l(),p("div",ue,[i("div",me,w(s.name)+" ("+w(s.enName)+") ",1),r(Q,{flat:"",round:"",color:"primary",icon:"volume_up",onClick:S=>e.speakEmotion(s)},null,8,["onClick"])])):b("",!0)],2))),128))])]),_:1})]),_:1})])):b("",!0)])]),_:1})}const Pe=V(H,[["render",pe],["__scopeId","data-v-bdb2db6c"],["__file","PlaybackPage.vue"]]);export{Pe as default};
