import{N as W,r as i,o as z,_ as U,P as R,R as j,S as c,V as l,U as n,Q as O,X as b,$ as B,W as y,a0 as Z,Y as J,a6 as x,Z as G,t as K}from"./index-UjihqO3d.js";import{Q}from"./QCardSection-CuOX7ocO.js";import{Q as S}from"./QCard-BkJjBWao.js";import{Q as X}from"./QDialog-BXzMAm3g.js";import{Q as _,C as ee}from"./ClosePopup-BWNaoVaI.js";import{Q as te}from"./QPage-CzvBLiTL.js";import{a as ae}from"./axios-upsvKRUO.js";import"./use-dark-T73MqeRw.js";import"./use-timeout-DW1L0Bdj.js";import"./focus-manager-BJWzFvJg.js";const se=W({name:"HandWrittenPage",props:{devMode:{type:Boolean,default:!1}},setup(){const e=i(null),t=i(null),p=i(!1),r=i("A"),C=i(!1),T=i(!1),s=i(""),D=i(!1),k=i(!1),M=i(0),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");let f=0,w=0;z(()=>{L(),q(),window.addEventListener("resize",L)});const q=()=>{const a=Math.floor(Math.random()*g.length);r.value=g[a],F()},F=()=>{console.log("currentLetter.value:",r.value);const a=new SpeechSynthesisUtterance("Please write the letter: "+A(r.value)+" "+r.value);a.lang="en",a.rate=1.2,a.pitch=1.1,a.volume=.8,speechSynthesis.speak(a)},L=()=>{if(!e.value)return;const a=280;e.value.width=a,e.value.height=a,e.value.style.width="100%",e.value.style.height="auto",e.value.style.aspectRatio="1/1",t.value=e.value.getContext("2d",{willReadFrequently:!0}),t.value&&(t.value.fillStyle="#FFFFFF",t.value.fillRect(0,0,e.value.width,e.value.height),t.value.strokeStyle="#000",t.value.lineWidth=8,t.value.lineCap="round",t.value.lineJoin="round")},Y=a=>{if(p.value=!0,!e.value)return;const o=e.value.getBoundingClientRect(),d=e.value.width/o.width,h=e.value.height/o.height;f=(a.clientX-o.left)*d,w=(a.clientY-o.top)*h},$=a=>{if(!p.value||!t.value||!e.value)return;const o=e.value.getBoundingClientRect(),d=e.value.width/o.width,h=e.value.height/o.height,m=(a.clientX-o.left)*d,u=(a.clientY-o.top)*h;t.value.beginPath(),t.value.moveTo(f,w),t.value.lineTo(m,u),t.value.stroke(),f=m,w=u},H=()=>{p.value=!1},I=a=>{if(a.preventDefault(),!e.value)return;const o=e.value.getBoundingClientRect(),d=a.touches[0];if(!d)return;const h=e.value.width/o.width,m=e.value.height/o.height,u=(d.clientX-o.left+window.pageXOffset)*h,v=(d.clientY-o.top+window.pageYOffset)*m;a.type==="touchstart"?(p.value=!0,f=u,w=v):a.type==="touchmove"&&p.value&&t.value&&(t.value.beginPath(),t.value.moveTo(f,w),t.value.lineTo(u,v),t.value.stroke(),f=u,w=v)},V=()=>{!t.value||!e.value||(t.value.fillStyle="#FFFFFF",t.value.fillRect(0,0,e.value.width,e.value.height))},E=()=>{let a;do a=Math.floor(Math.random()*g.length);while(g[a]===r.value);r.value=g[a],F(),V(),C.value=!1},A=a=>a.toLowerCase()===a?"lowercase":"capital";return{canvas:e,currentLetter:r,showResult:C,showHint:T,resultMessage:s,isCorrect:D,isChecking:k,score:M,startDrawing:Y,draw:$,stopDrawing:H,handleTouch:I,clearCanvas:V,checkAnswer:async()=>{if(!(!e.value||!t.value)){k.value=!0;try{const a=t.value.getImageData(0,0,e.value.width,e.value.height),o=document.createElement("canvas");o.width=e.value.width,o.height=e.value.height,o.getContext("2d")?.putImageData(a,0,0);const h=await new Promise(N=>{o.toBlob(P=>{P&&N(P)},"image/png")}),m=new FormData;m.append("image",h,"drawing.png");const u=A(r.value);console.log("字母大小寫:",u),console.log("當前字母:",r.value);const v=await ae.post(`https://zh-en-backend.alearn13994229.workers.dev/detect-letter/${u}/${r.value}`,m);console.log("response:",v),console.log("response.data:",v.data),console.log("response.data.letter:",v.data.letter),v.data.letter===r.value?(D.value=!0,s.value="太棒了！寫得很好！",M.value+=10,C.value=!0,setTimeout(()=>{E()},1500)):(D.value=!1,s.value="再試一次，記得要寫工整喔！",C.value=!0)}catch(a){console.error("Error checking answer:",a)}finally{k.value=!1}}},nextLetter:E,randomLetter:q,letters:g,detectLetterCase:A,sayPleaseWrite:F}}}),oe={class:"row items-center q-mb-md"},le={class:"col"},ne={class:"text-h6 q-mb-md text-center"},re={class:"text-primary text-weight-bold text-h4"},ie={class:"text-subtitle1 q-mt-sm"},ue={class:"text-positive"},ce={class:"row justify-center q-mb-md"},de={class:"col-12 col-sm-6 col-md-4"},ve={class:"canvas-container"},he={class:"row q-gutter-sm justify-center q-mt-md"},me={key:0,class:"text-center q-mt-md"},pe={class:"text-h6"},ge=["src"];function fe(e,t,p,r,C,T){return R(),j(te,{class:"q-pa-md"},{default:c(()=>[l("div",oe,[l("h1",le,[n(O,{name:"edit",size:"md",color:"primary",class:"q-mr-sm"}),t[10]||(t[10]=b(" 英文字母手寫練習 "))])]),l("div",ne,[l("div",null,[t[11]||(t[11]=b(" 請寫出字母：")),l("span",re,B(e.currentLetter),1)]),l("div",ie,[t[12]||(t[12]=b(" 得分：")),l("span",ue,B(e.score),1)])]),l("div",ce,[l("div",de,[l("div",ve,[l("canvas",{ref:"canvas",class:"writing-canvas",onMousedown:t[0]||(t[0]=(...s)=>e.startDrawing&&e.startDrawing(...s)),onMousemove:t[1]||(t[1]=(...s)=>e.draw&&e.draw(...s)),onMouseup:t[2]||(t[2]=(...s)=>e.stopDrawing&&e.stopDrawing(...s)),onMouseleave:t[3]||(t[3]=(...s)=>e.stopDrawing&&e.stopDrawing(...s)),onTouchstart:t[4]||(t[4]=(...s)=>e.handleTouch&&e.handleTouch(...s)),onTouchmove:t[5]||(t[5]=(...s)=>e.handleTouch&&e.handleTouch(...s)),onTouchend:t[6]||(t[6]=(...s)=>e.stopDrawing&&e.stopDrawing(...s))},null,544)]),l("div",he,[n(y,{color:"primary",icon:"check_circle",label:"檢查",onClick:e.checkAnswer,loading:e.isChecking},null,8,["onClick","loading"]),n(y,{color:"secondary",icon:"refresh",label:"清除",onClick:e.clearCanvas},null,8,["onClick"]),n(y,{color:"accent",icon:"skip_next",label:"下一個",onClick:e.nextLetter},null,8,["onClick"])]),e.devMode?(R(),Z("div",me,[n(y,{flat:"",color:"info",icon:"help",label:"顯示筆順",onClick:t[7]||(t[7]=s=>e.showHint=!0)})])):J("",!0)])]),n(X,{modelValue:e.showResult,"onUpdate:modelValue":t[8]||(t[8]=s=>e.showResult=s)},{default:c(()=>[n(S,{style:{"min-width":"300px"}},{default:c(()=>[n(Q,{class:"row items-center"},{default:c(()=>[n(x,{icon:e.isCorrect?"sentiment_very_satisfied":"sentiment_dissatisfied",color:e.isCorrect?"positive":"negative","text-color":"white"},null,8,["icon","color"]),l("span",{class:G(["text-h6 q-ml-md",e.isCorrect?"text-positive":"text-negative"])},B(e.resultMessage),3)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(X,{modelValue:e.showHint,"onUpdate:modelValue":t[9]||(t[9]=s=>e.showHint=s)},{default:c(()=>[n(S,null,{default:c(()=>[n(Q,null,{default:c(()=>[l("div",pe,"字母 "+B(e.currentLetter)+" 的筆順",1)]),_:1}),n(Q,{class:"q-pt-none"},{default:c(()=>[l("img",{src:`/images/letters/${e.currentLetter.toLowerCase()}.gif`,alt:"筆順動畫"},null,8,ge)]),_:1}),n(_,{align:"right"},{default:c(()=>[K(n(y,{flat:"",label:"關閉",color:"primary"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Me=U(se,[["render",fe],["__scopeId","data-v-34ac888c"],["__file","HandWrittenPage.vue"]]);export{Me as default};
