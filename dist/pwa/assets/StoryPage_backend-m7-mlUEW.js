import{N as I,r as d,K as A,_ as L,P as h,R,S as t,V as r,U as a,Q as E,X as v,ag as z,ah as U,ai as q,$ as p,W as k,a0 as w,a2 as G,a1 as J,Y as V}from"./index-UjihqO3d.js";import{Q as M}from"./QInput-Byf375NZ.js";import{Q as F,b as $,a as P,c as K}from"./QLinearProgress-CxVy68gR.js";import{u as W,Q as X,a as j}from"./use-quasar-BqTlNkVl.js";import{Q as N}from"./QCard-BkJjBWao.js";import{Q as Y}from"./QImg-3Uy5ouB2.js";import{Q as H}from"./QCardSection-CuOX7ocO.js";import{Q as Z}from"./QDialog-BXzMAm3g.js";import{Q as x}from"./QPage-CzvBLiTL.js";import"./use-file-dom-props-B-XjYtyc.js";import"./use-id-F4OpCJgO.js";import"./use-dark-T73MqeRw.js";import"./focus-manager-BJWzFvJg.js";import"./QChip-CC2Bhlwa.js";import"./position-engine-DImddh63.js";import"./selection-C5fvtrYK.js";import"./use-timeout-DW1L0Bdj.js";import"./format-CJebrXOQ.js";const ee=I({name:"StoryPageBackend",emits:["closeLeftDrawer"],setup(o,{emit:s}){const m=W(),B=d(!1),y=A({childName:"",ageGroup:"",storyType:""}),S=d(!1),e=d("正在生成故事..."),l=d(null),g=d([]),C=d([]),c=d([]),D=d(null),O=d(null);return{formData:y,loading:B,showProgress:S,progressMessage:e,generatedStory:l,storyParagraphs:g,paragraphImages:C,translatedParagraphs:c,audioPlayer:D,storySection:O,printStory:()=>{console.log("列印故事"),l.value?(s("closeLeftDrawer"),setTimeout(()=>{window.print()},1e3)):m.notify({type:"negative",message:"故事尚未生成"})},generateStory:async()=>{try{B.value=!0,S.value=!0,g.value=[],C.value=[],c.value=[],l.value=null,e.value="正在創作故事...";const n=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({childName:y.childName,ageGroup:y.ageGroup,storyType:y.storyType,step:1})});if(!n.ok)throw new Error("故事生成失敗");const f=await n.json();if(!f.success)throw new Error(f.error||"故事生成失敗");g.value=f.content.split(`

`).filter(i=>i.trim());for(let i=0;i<g.value.length;i++){e.value=`正在翻譯...${i+1}/${g.value.length}`;const Q=g.value[i],T=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:Q})})).text();c.value.push(T)}for(let i=0;i<c.value.length;i++){const Q=c.value[i];e.value=`正在生成配圖...${i+1}/${c.value.length}`;const _=await fetch("https://zh-en-backend.alearn13994229.workers.dev/generate-image-by-single-paragraph",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyParagraph:Q})});if(!_.ok)throw new Error("圖片生成失敗");const T=await _.json();C.value.push(T.image)}e.value="正在生成語音...";const b=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({step:3,content:c.value.join()})});if(!b.ok)throw new Error("語音生成失敗");const u=await b.json();if(!u.success)throw new Error(u.error||"語音生成失敗");l.value={content:f.content,audioUrl:u.audioUrl},setTimeout(()=>{D.value&&D.value.play(),O.value?.scrollIntoView({behavior:"smooth",block:"start"})},1e3),m.notify({type:"positive",message:"故事生成完成！",position:"top"})}catch(n){m.notify({type:"negative",message:`發生錯誤：${n instanceof Error?n.message:"請稍後重試"}`,position:"top"}),console.error("生成故事時發生錯誤：",n)}finally{B.value=!1,S.value=!1}},audioEnded:()=>{console.log("音頻播放結束")},downloadAudio:async()=>{try{if(!l.value?.audioUrl)throw new Error("找不到音頻檔案");const f=await(await fetch(l.value.audioUrl)).blob(),b=window.URL.createObjectURL(f),u=document.createElement("a");u.href=b,u.download=`${y.childName}的故事.mp3`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(b),document.body.removeChild(u),m.notify({type:"positive",message:"音頻檔案下載成功！",position:"top"})}catch(n){m.notify({type:"negative",message:`下載失敗：${n instanceof Error?n.message:"請稍後重試"}`,position:"top"}),console.error("下載音頻時發生錯誤：",n)}},ageOptions:[{label:"2-4歲 (學前)",value:"2-4",description:"簡單有趣的故事，適合幼兒園前的寶寶"},{label:"5-7歲 (幼兒園)",value:"5-7",description:"包含基礎生活詞彙的故事"},{label:"8-10歲 (小學)",value:"8-10",description:"較長的故事，豐富的詞彙和情節"},{label:"10+歲 (小學高年級以上)",value:"10+",description:"更長的故事，更豐富的詞彙和情節"}],storyTypeOptions:[{label:"冒險故事",value:"adventure",description:"充滿刺激和挑戰的冒險故事"},{label:"童話故事",value:"fairy_tale",description:"充滿魔法和想像力的奇幻故事"},{label:"教育故事",value:"educational",description:"包含生活教育意義的啟發性故事"},{label:"動物故事",value:"animal",description:"以可愛動物為主角的溫馨故事"},{label:"科幻故事",value:"sci_fi",description:"激發想像力的科學幻想故事"}]}}}),oe={class:"story-container"},ae={class:"hero-title"},te={class:"input-group"},se={class:"input-group"},re={class:"input-group"},le={class:"row justify-center q-mt-lg"},ne={key:0,ref:"storySection",class:"story-section q-mt-xl"},ie={class:"story-title q-mb-lg"},ue={class:"story-content col-12 col-md-7"},de={class:"text-body1"},pe={class:"text-body1"},ce={key:0,class:"story-image col-12 col-md-5"},me={key:0,class:"audio-player"},ye=["src"],ge={class:"row justify-end q-mt-md"},fe={class:"q-ml-sm"};function he(o,s,m,B,y,S){return h(),R(x,{class:"story-page"},{default:t(()=>[r("div",oe,[r("h2",ae,[a(E,{name:"auto_stories",size:"md",color:"primary",class:"q-mr-sm"}),s[5]||(s[5]=v(" Create your own ")),s[6]||(s[6]=r("span",{class:"highlight"},"Bedtime Stories",-1)),s[7]||(s[7]=r("div",{class:"subtitle"},"為您的孩子創造獨特的睡前故事",-1))]),a(N,{class:"form-card q-pa-xl"},{default:t(()=>[a(X,{onSubmit:z(o.generateStory,["prevent"]),class:"q-gutter-md"},{default:t(()=>[r("div",te,[a(M,{modelValue:o.formData.childName,"onUpdate:modelValue":s[0]||(s[0]=e=>o.formData.childName=e),outlined:"",label:"孩子的名字",rules:[e=>!!e||"請輸入名字",e=>e.length<=20||"名字不能超過20個字符"]},{prepend:t(()=>[a(E,{name:"person"})]),hint:t(()=>s[8]||(s[8]=[v(" 可以輸入中文或英文名字 ")])),_:1},8,["modelValue","rules"])]),r("div",se,[a(j,{modelValue:o.formData.ageGroup,"onUpdate:modelValue":s[1]||(s[1]=e=>o.formData.ageGroup=e),options:o.ageOptions,outlined:"",label:"年齡段","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇年齡段"]},{prepend:t(()=>[a(E,{name:"child_care"})]),option:t(e=>[a(F,U(q(e.itemProps)),{default:t(()=>[a($,null,{default:t(()=>[a(P,null,{default:t(()=>[v(p(e.opt.label),1)]),_:2},1024),a(P,{caption:""},{default:t(()=>[v(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",re,[a(j,{modelValue:o.formData.storyType,"onUpdate:modelValue":s[2]||(s[2]=e=>o.formData.storyType=e),options:o.storyTypeOptions,outlined:"",label:"故事類型","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇故事類型"]},{prepend:t(()=>[a(E,{name:"auto_stories"})]),option:t(e=>[a(F,U(q(e.itemProps)),{default:t(()=>[a($,null,{default:t(()=>[a(P,null,{default:t(()=>[v(p(e.opt.label),1)]),_:2},1024),a(P,{caption:""},{default:t(()=>[v(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",le,[a(k,{type:"submit",color:"primary",label:"開始創建故事",loading:o.loading,class:"submit-btn"},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),o.generatedStory?(h(),w("div",ne,[a(N,{class:"story-card q-pa-lg"},{default:t(()=>[r("h3",ie,p(o.formData.childName)+" 的故事",1),(h(!0),w(G,null,J(o.storyParagraphs,(e,l)=>(h(),w("div",{key:l,class:"paragraph-section q-mb-xl row items-start q-col-gutter-lg"},[r("div",ue,[r("p",de,p(o.translatedParagraphs[l]),1),r("p",pe,p(e),1)]),o.paragraphImages[l]?(h(),w("div",ce,[a(Y,{src:o.paragraphImages[l],"spinner-color":"primary",style:{"border-radius":"12px","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},null,8,["src"])])):V("",!0)]))),128)),o.generatedStory.audioUrl?(h(),w("div",me,[r("audio",{ref:"audioPlayer",src:o.generatedStory.audioUrl,controls:"",class:"full-width",onEnded:s[3]||(s[3]=(...e)=>o.audioEnded&&o.audioEnded(...e))},null,40,ye)])):V("",!0),r("div",ge,[a(k,{flat:"",color:"primary",label:"下載語音",disable:o.loading||!o.generatedStory?.audioUrl,onClick:o.downloadAudio,icon:"download"},null,8,["disable","onClick"]),a(k,{flat:"",color:"primary",label:"列印故事",disable:o.loading,onClick:o.printStory,icon:"print"},null,8,["disable","onClick"]),a(k,{flat:"",color:"primary",label:"重新生成",disable:o.loading,onClick:o.generateStory,icon:"refresh"},null,8,["disable","onClick"])])]),_:1})],512)):V("",!0),a(Z,{modelValue:o.showProgress,"onUpdate:modelValue":s[4]||(s[4]=e=>o.showProgress=e),persistent:""},{default:t(()=>[a(N,{style:{"min-width":"300px"}},{default:t(()=>[a(H,{class:"row items-center"},{default:t(()=>[r("span",fe,p(o.progressMessage),1),a(K,{indeterminate:"",class:"q-mt-md",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Re=L(ee,[["render",he],["__scopeId","data-v-7165865e"],["__file","StoryPage_backend.vue"]]);export{Re as default};
