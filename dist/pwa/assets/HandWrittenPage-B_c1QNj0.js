import{N as W,r,o as N,_ as z,P as U,R as j,S as c,V as o,U as n,Q as O,X as b,$ as D,W as y,a6 as Z,Z as x,t as J}from"./index-RHGYJRSl.js";import{Q}from"./QCardSection-e_08GvMP.js";import{Q as V}from"./QCard-VFcAIl4Z.js";import{Q as E}from"./QDialog-DoZuOEN0.js";import{Q as G,C as K}from"./ClosePopup-UAGUDdJ8.js";import{Q as _}from"./QPage-DslxCrtw.js";import{a as ee}from"./axios-upsvKRUO.js";import"./use-dark-GVP7KRo8.js";import"./use-timeout-D8APp4VK.js";import"./focus-manager-BJWzFvJg.js";const te=W({name:"HandWrittenPage",setup(){const e=r(null),t=r(null),p=r(!1),i=r("A"),C=r(!1),T=r(!1),s=r(""),B=r(!1),F=r(!1),q=r(0),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");let f=0,w=0;N(()=>{M(),L(),window.addEventListener("resize",M)});const L=()=>{const a=Math.floor(Math.random()*g.length);i.value=g[a],k()},k=()=>{console.log("currentLetter.value:",i.value);const a=new SpeechSynthesisUtterance("Please write the letter: "+A(i.value)+" "+i.value);a.lang="en",a.rate=1.2,a.pitch=1.1,a.volume=.8,speechSynthesis.speak(a)},M=()=>{if(!e.value)return;const a=280;e.value.width=a,e.value.height=a,e.value.style.width="100%",e.value.style.height="auto",e.value.style.aspectRatio="1/1",t.value=e.value.getContext("2d",{willReadFrequently:!0}),t.value&&(t.value.fillStyle="#FFFFFF",t.value.fillRect(0,0,e.value.width,e.value.height),t.value.strokeStyle="#000",t.value.lineWidth=8,t.value.lineCap="round",t.value.lineJoin="round")},X=a=>{if(p.value=!0,!e.value)return;const l=e.value.getBoundingClientRect(),d=e.value.width/l.width,h=e.value.height/l.height;f=(a.clientX-l.left)*d,w=(a.clientY-l.top)*h},Y=a=>{if(!p.value||!t.value||!e.value)return;const l=e.value.getBoundingClientRect(),d=e.value.width/l.width,h=e.value.height/l.height,m=(a.clientX-l.left)*d,u=(a.clientY-l.top)*h;t.value.beginPath(),t.value.moveTo(f,w),t.value.lineTo(m,u),t.value.stroke(),f=m,w=u},$=()=>{p.value=!1},H=a=>{if(a.preventDefault(),!e.value)return;const l=e.value.getBoundingClientRect(),d=a.touches[0];if(!d)return;const h=e.value.width/l.width,m=e.value.height/l.height,u=(d.clientX-l.left+window.pageXOffset)*h,v=(d.clientY-l.top+window.pageYOffset)*m;a.type==="touchstart"?(p.value=!0,f=u,w=v):a.type==="touchmove"&&p.value&&t.value&&(t.value.beginPath(),t.value.moveTo(f,w),t.value.lineTo(u,v),t.value.stroke(),f=u,w=v)},P=()=>{!t.value||!e.value||(t.value.fillStyle="#FFFFFF",t.value.fillRect(0,0,e.value.width,e.value.height))},R=()=>{let a;do a=Math.floor(Math.random()*g.length);while(g[a]===i.value);i.value=g[a],k(),P(),C.value=!1},A=a=>a.toLowerCase()===a?"lowercase":"capital";return{canvas:e,currentLetter:i,showResult:C,showHint:T,resultMessage:s,isCorrect:B,isChecking:F,score:q,startDrawing:X,draw:Y,stopDrawing:$,handleTouch:H,clearCanvas:P,checkAnswer:async()=>{if(!(!e.value||!t.value)){F.value=!0;try{const a=t.value.getImageData(0,0,e.value.width,e.value.height),l=document.createElement("canvas");l.width=e.value.width,l.height=e.value.height,l.getContext("2d")?.putImageData(a,0,0);const h=await new Promise(I=>{l.toBlob(S=>{S&&I(S)},"image/png")}),m=new FormData;m.append("image",h,"drawing.png");const u=A(i.value);console.log("字母大小寫:",u),console.log("當前字母:",i.value);const v=await ee.post(`https://zh-en-backend.alearn13994229.workers.dev/detect-letter/${u}/${i.value}`,m);console.log("response:",v),console.log("response.data:",v.data),console.log("response.data.letter:",v.data.letter),v.data.letter===i.value?(B.value=!0,s.value="太棒了！寫得很好！",q.value+=10,C.value=!0,setTimeout(()=>{R()},1500)):(B.value=!1,s.value="再試一次，記得要寫工整喔！",C.value=!0)}catch(a){console.error("Error checking answer:",a)}finally{F.value=!1}}},nextLetter:R,randomLetter:L,letters:g,detectLetterCase:A,sayPleaseWrite:k}}}),ae={class:"row items-center q-mb-md"},se={class:"col"},le={class:"text-h6 q-mb-md text-center"},oe={class:"text-primary text-weight-bold text-h4"},ne={class:"text-subtitle1 q-mt-sm"},ie={class:"text-positive"},re={class:"row justify-center q-mb-md"},ue={class:"col-12 col-sm-6 col-md-4"},ce={class:"canvas-container"},de={class:"row q-gutter-sm justify-center q-mt-md"},ve={class:"text-center q-mt-md"},he={class:"text-h6"},me=["src"];function pe(e,t,p,i,C,T){return U(),j(_,{class:"q-pa-md"},{default:c(()=>[o("div",ae,[o("h1",se,[n(O,{name:"edit",size:"md",color:"primary",class:"q-mr-sm"}),t[10]||(t[10]=b(" 英文字母手寫練習 "))])]),o("div",le,[o("div",null,[t[11]||(t[11]=b(" 請寫出字母：")),o("span",oe,D(e.currentLetter),1)]),o("div",ne,[t[12]||(t[12]=b(" 得分：")),o("span",ie,D(e.score),1)])]),o("div",re,[o("div",ue,[o("div",ce,[o("canvas",{ref:"canvas",class:"writing-canvas",onMousedown:t[0]||(t[0]=(...s)=>e.startDrawing&&e.startDrawing(...s)),onMousemove:t[1]||(t[1]=(...s)=>e.draw&&e.draw(...s)),onMouseup:t[2]||(t[2]=(...s)=>e.stopDrawing&&e.stopDrawing(...s)),onMouseleave:t[3]||(t[3]=(...s)=>e.stopDrawing&&e.stopDrawing(...s)),onTouchstart:t[4]||(t[4]=(...s)=>e.handleTouch&&e.handleTouch(...s)),onTouchmove:t[5]||(t[5]=(...s)=>e.handleTouch&&e.handleTouch(...s)),onTouchend:t[6]||(t[6]=(...s)=>e.stopDrawing&&e.stopDrawing(...s))},null,544)]),o("div",de,[n(y,{color:"primary",icon:"check_circle",label:"檢查",onClick:e.checkAnswer,loading:e.isChecking},null,8,["onClick","loading"]),n(y,{color:"secondary",icon:"refresh",label:"清除",onClick:e.clearCanvas},null,8,["onClick"]),n(y,{color:"accent",icon:"skip_next",label:"下一個",onClick:e.nextLetter},null,8,["onClick"])]),o("div",ve,[n(y,{flat:"",color:"info",icon:"help",label:"顯示筆順",onClick:t[7]||(t[7]=s=>e.showHint=!0)})])])]),n(E,{modelValue:e.showResult,"onUpdate:modelValue":t[8]||(t[8]=s=>e.showResult=s)},{default:c(()=>[n(V,{style:{"min-width":"300px"}},{default:c(()=>[n(Q,{class:"row items-center"},{default:c(()=>[n(Z,{icon:e.isCorrect?"sentiment_very_satisfied":"sentiment_dissatisfied",color:e.isCorrect?"positive":"negative","text-color":"white"},null,8,["icon","color"]),o("span",{class:x(["text-h6 q-ml-md",e.isCorrect?"text-positive":"text-negative"])},D(e.resultMessage),3)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(E,{modelValue:e.showHint,"onUpdate:modelValue":t[9]||(t[9]=s=>e.showHint=s)},{default:c(()=>[n(V,null,{default:c(()=>[n(Q,null,{default:c(()=>[o("div",he,"字母 "+D(e.currentLetter)+" 的筆順",1)]),_:1}),n(Q,{class:"q-pt-none"},{default:c(()=>[o("img",{src:`/images/letters/${e.currentLetter.toLowerCase()}.gif`,alt:"筆順動畫"},null,8,me)]),_:1}),n(G,{align:"right"},{default:c(()=>[J(n(y,{flat:"",label:"關閉",color:"primary"},null,512),[[K]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Qe=z(te,[["render",pe],["__scopeId","data-v-e64aa649"],["__file","HandWrittenPage.vue"]]);export{Qe as default};
