import{N as $,r as u,K as j,_ as I,P as f,R as A,S as s,V as r,U as a,Q as S,X as h,ag as R,ah as N,ai as O,$ as p,W as E,a0 as b,a2 as z,a1 as G,Y as _}from"./index-RHGYJRSl.js";import{Q as L}from"./QInput-BORL3gOf.js";import{Q as U,b as q,a as k,c as J}from"./QLinearProgress-BU3bleYP.js";import{u as M,Q as K,a as F}from"./use-quasar-BBUe1HTf.js";import{Q as T}from"./QCard-VFcAIl4Z.js";import{Q as W}from"./QImg-0g1J2xAe.js";import{Q as X}from"./QCardSection-e_08GvMP.js";import{Q as Y}from"./QDialog-DoZuOEN0.js";import{Q as H}from"./QPage-DslxCrtw.js";import"./use-file-dom-props-BkSmyL8o.js";import"./use-id-B3xohZU7.js";import"./use-dark-GVP7KRo8.js";import"./focus-manager-BJWzFvJg.js";import"./QChip-B5YaWmXE.js";import"./position-engine-DRplW0G5.js";import"./selection-CyZVrAg_.js";import"./use-timeout-D8APp4VK.js";import"./format-CJebrXOQ.js";const Z=$({name:"StoryPageBackend",setup(){const o=M(),t=u(!1),m=j({childName:"",ageGroup:"",storyType:""}),w=u(!1),y=u("正在生成故事..."),c=u(null),e=u([]),d=u([]),B=u([]),P=u(null),V=u(null);return{formData:m,loading:t,showProgress:w,progressMessage:y,generatedStory:c,storyParagraphs:e,paragraphImages:d,translatedParagraphs:B,audioPlayer:P,storySection:V,printStory:()=>{console.log("列印故事"),c.value?window.print():o.notify({type:"negative",message:"故事尚未生成"})},generateStory:async()=>{try{t.value=!0,w.value=!0,e.value=[],d.value=[],B.value=[],c.value=null,y.value="正在創作故事...";const l=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({childName:m.childName,ageGroup:m.ageGroup,storyType:m.storyType,step:1})});if(!l.ok)throw new Error("故事生成失敗");const g=await l.json();if(!g.success)throw new Error(g.error||"故事生成失敗");e.value=g.content.split(`

`).filter(n=>n.trim());for(let n=0;n<e.value.length;n++){y.value=`正在翻譯...${n+1}/${e.value.length}`;const C=e.value[n],D=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:C})})).text();B.value.push(D)}for(let n=0;n<e.value.length;n++){const C=e.value[n];y.value=`正在生成配圖...${n+1}/${e.value.length}`;const Q=await fetch("https://zh-en-backend.alearn13994229.workers.dev/generate-image-by-single-paragraph",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyParagraph:C})});if(!Q.ok)throw new Error("圖片生成失敗");const D=await Q.json();d.value.push(D.image)}y.value="正在生成語音...";const v=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({step:3,content:B.value.join()})});if(!v.ok)throw new Error("語音生成失敗");const i=await v.json();if(!i.success)throw new Error(i.error||"語音生成失敗");c.value={content:g.content,audioUrl:i.audioUrl},setTimeout(()=>{P.value&&P.value.play(),V.value?.scrollIntoView({behavior:"smooth",block:"start"})},1e3),o.notify({type:"positive",message:"故事生成完成！",position:"top"})}catch(l){o.notify({type:"negative",message:`發生錯誤：${l instanceof Error?l.message:"請稍後重試"}`,position:"top"}),console.error("生成故事時發生錯誤：",l)}finally{t.value=!1,w.value=!1}},audioEnded:()=>{console.log("音頻播放結束")},downloadAudio:async()=>{try{if(!c.value?.audioUrl)throw new Error("找不到音頻檔案");const g=await(await fetch(c.value.audioUrl)).blob(),v=window.URL.createObjectURL(g),i=document.createElement("a");i.href=v,i.download=`${m.childName}的故事.mp3`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(v),document.body.removeChild(i),o.notify({type:"positive",message:"音頻檔案下載成功！",position:"top"})}catch(l){o.notify({type:"negative",message:`下載失敗：${l instanceof Error?l.message:"請稍後重試"}`,position:"top"}),console.error("下載音頻時發生錯誤：",l)}},ageOptions:[{label:"2-4歲 (學前)",value:"2-4",description:"簡單有趣的故事，適合幼兒園前的寶寶"},{label:"5-7歲 (幼兒園)",value:"5-7",description:"包含基礎生活詞彙的故事"},{label:"8-10歲 (小學)",value:"8-10",description:"較長的故事，豐富的詞彙和情節"},{label:"10+歲 (小學高年級以上)",value:"10+",description:"更長的故事，更豐富的詞彙和情節"}],storyTypeOptions:[{label:"冒險故事",value:"adventure",description:"充滿刺激和挑戰的冒險故事"},{label:"童話故事",value:"fairy_tale",description:"充滿魔法和想像力的奇幻故事"},{label:"教育故事",value:"educational",description:"包含生活教育意義的啟發性故事"},{label:"動物故事",value:"animal",description:"以可愛動物為主角的溫馨故事"},{label:"科幻故事",value:"sci_fi",description:"激發想像力的科學幻想故事"}]}}}),x={class:"story-container"},ee={class:"hero-title"},oe={class:"input-group"},ae={class:"input-group"},te={class:"input-group"},se={class:"row justify-center q-mt-lg"},re={key:0,ref:"storySection",class:"story-section q-mt-xl"},le={class:"story-title q-mb-lg"},ne={class:"story-content col-12 col-md-7"},ie={class:"text-body1"},ue={class:"text-body1"},de={key:0,class:"story-image col-12 col-md-5"},pe={key:0,class:"audio-player"},ce=["src"],me={class:"row justify-end q-mt-md"},ye={class:"q-ml-sm"};function ge(o,t,m,w,y,c){return f(),A(H,{class:"story-page"},{default:s(()=>[r("div",x,[r("h2",ee,[a(S,{name:"auto_stories",size:"md",color:"primary",class:"q-mr-sm"}),t[5]||(t[5]=h(" Create your own ")),t[6]||(t[6]=r("span",{class:"highlight"},"Bedtime Stories",-1)),t[7]||(t[7]=r("div",{class:"subtitle"},"為您的孩子創造獨特的睡前故事",-1))]),a(T,{class:"form-card q-pa-xl"},{default:s(()=>[a(K,{onSubmit:R(o.generateStory,["prevent"]),class:"q-gutter-md"},{default:s(()=>[r("div",oe,[a(L,{modelValue:o.formData.childName,"onUpdate:modelValue":t[0]||(t[0]=e=>o.formData.childName=e),outlined:"",label:"孩子的名字",rules:[e=>!!e||"請輸入名字",e=>e.length<=20||"名字不能超過20個字符"]},{prepend:s(()=>[a(S,{name:"person"})]),hint:s(()=>t[8]||(t[8]=[h(" 可以輸入中文或英文名字 ")])),_:1},8,["modelValue","rules"])]),r("div",ae,[a(F,{modelValue:o.formData.ageGroup,"onUpdate:modelValue":t[1]||(t[1]=e=>o.formData.ageGroup=e),options:o.ageOptions,outlined:"",label:"年齡段","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇年齡段"]},{prepend:s(()=>[a(S,{name:"child_care"})]),option:s(e=>[a(U,N(O(e.itemProps)),{default:s(()=>[a(q,null,{default:s(()=>[a(k,null,{default:s(()=>[h(p(e.opt.label),1)]),_:2},1024),a(k,{caption:""},{default:s(()=>[h(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",te,[a(F,{modelValue:o.formData.storyType,"onUpdate:modelValue":t[2]||(t[2]=e=>o.formData.storyType=e),options:o.storyTypeOptions,outlined:"",label:"故事類型","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇故事類型"]},{prepend:s(()=>[a(S,{name:"auto_stories"})]),option:s(e=>[a(U,N(O(e.itemProps)),{default:s(()=>[a(q,null,{default:s(()=>[a(k,null,{default:s(()=>[h(p(e.opt.label),1)]),_:2},1024),a(k,{caption:""},{default:s(()=>[h(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",se,[a(E,{type:"submit",color:"primary",label:"開始創建故事",loading:o.loading,class:"submit-btn"},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),o.generatedStory?(f(),b("div",re,[a(T,{class:"story-card q-pa-lg"},{default:s(()=>[r("h3",le,p(o.formData.childName)+" 的故事",1),(f(!0),b(z,null,G(o.storyParagraphs,(e,d)=>(f(),b("div",{key:d,class:"paragraph-section q-mb-xl row items-start q-col-gutter-lg"},[r("div",ne,[r("p",ie,p(o.translatedParagraphs[d]),1),r("p",ue,p(e),1)]),o.paragraphImages[d]?(f(),b("div",de,[a(W,{src:o.paragraphImages[d],"spinner-color":"primary",style:{"border-radius":"12px","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},null,8,["src"])])):_("",!0)]))),128)),o.generatedStory.audioUrl?(f(),b("div",pe,[r("audio",{ref:"audioPlayer",src:o.generatedStory.audioUrl,controls:"",class:"full-width",onEnded:t[3]||(t[3]=(...e)=>o.audioEnded&&o.audioEnded(...e))},null,40,ce)])):_("",!0),r("div",me,[a(E,{flat:"",color:"primary",label:"下載語音",disable:o.loading||!o.generatedStory?.audioUrl,onClick:o.downloadAudio,icon:"download"},null,8,["disable","onClick"]),a(E,{flat:"",color:"primary",label:"列印故事",disable:o.loading,onClick:o.printStory,icon:"print"},null,8,["disable","onClick"]),a(E,{flat:"",color:"primary",label:"重新生成",disable:o.loading,onClick:o.generateStory,icon:"refresh"},null,8,["disable","onClick"])])]),_:1})],512)):_("",!0),a(Y,{modelValue:o.showProgress,"onUpdate:modelValue":t[4]||(t[4]=e=>o.showProgress=e),persistent:""},{default:s(()=>[a(T,{style:{"min-width":"300px"}},{default:s(()=>[a(X,{class:"row items-center"},{default:s(()=>[r("span",ye,p(o.progressMessage),1),a(J,{indeterminate:"",class:"q-mt-md",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ae=I(Z,[["render",ge],["__scopeId","data-v-ce19542a"],["__file","StoryPage_backend.vue"]]);export{Ae as default};
