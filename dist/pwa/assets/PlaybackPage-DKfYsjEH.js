import{c as A,b as Q,h as _,d as C,j,N as O,r as m,_ as V,P as l,R,S as p,V as r,U as n,Q as F,X as q,a0 as h,$ as g,Y as w,W as P,a2 as I,a1 as U,Z as J}from"./index-ogN80PY1.js";import{Q as z}from"./QSpinnerDots-DMfFFOUY.js";import{u as L,a as M}from"./use-dark-DpO9ZDJ6.js";import{Q as Z}from"./QLinearProgress-BlzfbVns.js";import{Q as W}from"./QInput-DBauZuK9.js";import{Q as D}from"./QCardSection-CTWtOoZj.js";import{Q as T}from"./QCard-pvLSlSOR.js";import{Q as X}from"./QImg-Cqj6pXX9.js";import{Q as Y}from"./QPage-Db9eiev5.js";import"./use-field-9eEjOZsc.js";import"./use-id-ByTOMxm9.js";import"./focus-manager-DhdJisJs.js";import"./use-file-dom-props-s9kiYV3V.js";import"./use-key-composition-Cg76UZ0t.js";import"./use-timeout-D5cZhnC8.js";const G=A({name:"QBanner",props:{...L,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(e,{slots:a}){const{proxy:{$q:f}}=j(),y=M(e,f),c=Q(()=>"q-banner row items-center"+(e.dense===!0?" q-banner--dense":"")+(y.value===!0?" q-banner--dark q-dark":"")+(e.rounded===!0?" rounded-borders":"")),v=Q(()=>`q-banner__actions row items-center justify-end col-${e.inlineActions===!0?"auto":"all"}`);return()=>{const t=[_("div",{class:"q-banner__avatar col-auto row items-center self-start"},C(a.avatar)),_("div",{class:"q-banner__content col text-body2"},C(a.default))],d=C(a.action);return d!==void 0&&t.push(_("div",{class:v.value},d)),_("div",{class:c.value+(e.inlineActions===!1&&d!==void 0?" q-banner--top-padding":""),role:"alert"},t)}}}),H=O({name:"PlaybackPage",setup(){const e=m(""),a=m(""),f=m([]),y=m(!1),c=m(""),v=m(!1),t=m(""),d=async o=>{t.value="正在翻譯故事內容...";const s=await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-en-to-zh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})});if(!s.ok)throw new Error("翻譯失敗");const i=await s.text();return a.value=i,i},S=async o=>{t.value="正在分析故事情緒...";const s=await fetch("https://zh-en-backend.alearn13994229.workers.dev/emotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})});if(!s.ok)throw new Error("情緒分析失敗");return{emotions:((await s.json()).emotions||[]).map(u=>u?{name:(u.split(":")[0]||"").trim().replace(/^\d+\./,"")}:{name:""})}},B=async(o,s)=>{t.value=`正在生成 ${s} 的情緒圖片...`;const i=await fetch("https://zh-en-backend.alearn13994229.workers.dev/playback/image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story:o,emotion:s})});if(!i.ok)throw new Error("圖片生成失敗");return await i.json()},N=async o=>{t.value=`正在翻譯 ${o} 的英文說明...`;const s=await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:`這個情緒是${o}`})});if(!s.ok)throw new Error("情緒翻譯失敗");return await s.text()},$=o=>{speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(o.enName);s.lang="en-US",s.rate=.8,speechSynthesis.speak(s)},x=async o=>{f.value=o.map(s=>({...s,showContent:!0,moveStep:0}))};return{userStory:e,translatedStory:a,emotions:f,loading:y,error:c,showProgress:v,progressMessage:t,analyzeEmotion:async()=>{if(!e.value.trim()){c.value="請輸入故事內容";return}y.value=!0,v.value=!0,c.value="";try{const o=e.value.trim(),s=await d(o),i=await S(s),b=[];for(const u of i.emotions){const k=await B(s,u.name);if(!k.images||!Array.isArray(k.images))throw new Error(`${u.name} 的圖片生成結果格式不正確`);const E=await N(u.name);b.push({name:u.name,enName:E,imageUrl:k.images[0]||"",isAnimating:!1,showContent:!1,moveStep:0})}await x(b)}catch(o){c.value=o instanceof Error?o.message:"分析過程發生錯誤，請稍後再試"}finally{y.value=!1,v.value=!1,t.value=""}},speakEmotion:$}}}),K={class:"row items-center q-mb-md"},ee={class:"col"},te={key:0,class:"loading-section"},se={class:"text-subtitle1 q-mt-md"},oe={key:1,class:"error-section"},ae={key:2,class:"progress-section"},ne={class:"text-subtitle1 text-center"},re={class:"row q-col-gutter-md"},ie={class:"col-12 col-md-6"},le={class:"input-blob-container"},ce={class:"text-center"},de={key:0,class:"col-12 col-md-6"},ue={class:"emotion-grid"},me={key:0,class:"emotion-content"},pe={class:"text-subtitle1 q-mt-sm"};function he(e,a,f,y,c,v){return l(),R(Y,{class:"q-pa-md"},{default:p(()=>[r("div",K,[r("h1",ee,[n(F,{name:"psychology",size:"md",color:"primary",class:"q-mr-sm"}),a[1]||(a[1]=q(" 今日回顧 | Daily Reflection "))])]),e.loading?(l(),h("div",te,[n(z,{color:"primary",size:"3em"}),r("p",se,g(e.progressMessage),1)])):w("",!0),e.error?(l(),h("div",oe,[n(G,{class:"bg-negative text-white"},{default:p(()=>[q(g(e.error),1)]),_:1})])):w("",!0),e.showProgress?(l(),h("div",ae,[n(Z,{indeterminate:"",rounded:"",size:"md",color:"primary",class:"q-mb-sm"}),r("div",ne,g(e.progressMessage),1)])):w("",!0),r("div",re,[r("div",ie,[n(T,{class:"rpg-card"},{default:p(()=>[n(D,null,{default:p(()=>[a[2]||(a[2]=r("div",{class:"text-h6 q-mb-md"},"分享今天最深刻的經歷",-1)),r("div",le,[n(W,{modelValue:e.userStory,"onUpdate:modelValue":a[0]||(a[0]=t=>e.userStory=t),type:"textarea",rows:"6",placeholder:`請用英文或中文描述...
Please describe in English or Chinese...`,class:"custom-input"},null,8,["modelValue"])]),r("div",ce,[n(P,{color:"primary",label:"分析情緒",loading:e.loading,onClick:e.analyzeEmotion,class:"rpg-button"},{loading:p(()=>[n(z)]),_:1},8,["loading","onClick"])])]),_:1})]),_:1})]),e.emotions.length>0?(l(),h("div",de,[n(T,{class:"rpg-card"},{default:p(()=>[n(D,null,{default:p(()=>[a[3]||(a[3]=r("div",{class:"text-h6 q-mb-md"},"情緒分析結果",-1)),r("div",ue,[(l(!0),h(I,null,U(e.emotions,(t,d)=>(l(),h("div",{key:d,class:J(["emotion-item",{"move-step-1":t.moveStep===1,"move-step-2":t.moveStep===2,"show-content":t.showContent}])},[n(X,{src:t.imageUrl,"spinner-color":"primary",style:{height:"200px","max-width":"200px"},class:"rounded-borders"},null,8,["src"]),t.showContent?(l(),h("div",me,[r("div",pe,g(t.name)+" ("+g(t.enName)+") ",1),n(P,{flat:"",round:"",color:"primary",icon:"volume_up",onClick:S=>e.speakEmotion(t)},null,8,["onClick"])])):w("",!0)],2))),128))])]),_:1})]),_:1})])):w("",!0)])]),_:1})}const Te=V(H,[["render",he],["__scopeId","data-v-cb5522e8"],["__file","PlaybackPage.vue"]]);export{Te as default};
