import{c as A,b as S,h as b,d as C,j as F,N as O,r as m,_ as V,P as c,R as $,S as i,V as o,U as a,Q as I,X as x,a0 as d,$ as p,Y as f,a2 as Q,a1 as D,W as P}from"./index-DxbVdBgM.js";import{Q as B}from"./QSpinnerDots-DLKKSYvz.js";import{u as U,a as M}from"./use-dark-CzGRvFCT.js";import{Q as J}from"./QLinearProgress-D37eqeIa.js";import{Q as T}from"./QImg-CL5U2aAz.js";import{Q as k}from"./QCardSection-BCCwvmUl.js";import{Q as w}from"./QCard-uS9gx_jg.js";import{Q as L}from"./QInput-CA-WEHZV.js";import{Q as H}from"./QPage-Deh1hDTK.js";import"./use-timeout-COFA4DYE.js";import"./use-file-dom-props-QwnIH0ge.js";import"./use-id-BQUSKQsF.js";import"./focus-manager-BJWzFvJg.js";const W=A({name:"QBanner",props:{...U,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(e,{slots:s}){const{proxy:{$q:h}}=F(),u=M(e,h),v=S(()=>"q-banner row items-center"+(e.dense===!0?" q-banner--dense":"")+(u.value===!0?" q-banner--dark q-dark":"")+(e.rounded===!0?" rounded-borders":"")),g=S(()=>`q-banner__actions row items-center justify-end col-${e.inlineActions===!0?"auto":"all"}`);return()=>{const t=[b("div",{class:"q-banner__avatar col-auto row items-center self-start"},C(s.avatar)),b("div",{class:"q-banner__content col text-body2"},C(s.default))],l=C(s.action);return l!==void 0&&t.push(b("div",{class:g.value},l)),b("div",{class:v.value+(e.inlineActions===!1&&l!==void 0?" q-banner--top-padding":""),role:"alert"},t)}}}),X=O({name:"PlaybackPage",setup(){const e=m(""),s=m([]),h=m(!1),u=m(""),v=m({emotions:[],images:[],expression:""}),g=m(!1),t=m(""),l=async n=>{t.value="正在翻譯故事內容...";const r=await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n})});if(console.log("111111response",r),!r.ok)throw new Error("翻譯失敗");return await r.json()},q=async n=>{t.value="正在分析故事情緒...";const r=await fetch("https://zh-en-backend.alearn13994229.workers.dev/emotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n})});if(!r.ok)throw new Error("情緒分析失敗");return await r.json()},z=async n=>{t.value="正在生成情緒圖片...";const r=await fetch("https://zh-en-backend.alearn13994229.workers.dev/images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emotions:n})});if(!r.ok)throw new Error("圖片生成失敗");return await r.json()},j=async(n,r,y)=>{t.value="正在生成表達分析...";const _=await fetch("https://zh-en-backend.alearn13994229.workers.dev/expression",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story:n,emotions:r,images:y})});if(!_.ok)throw new Error("表達分析生成失敗");return await _.json()};return{userStory:e,emotions:s,loading:h,error:u,expressionResult:v,showProgress:g,progressMessage:t,analyzeEmotion:async()=>{if(!e.value.trim()){u.value="請輸入故事內容";return}h.value=!0,g.value=!0,u.value="";try{const n=e.value.trim(),r=await l(n),y=await q(r.content),_=await z(y.emotions),E=await j(n,y.emotions,_.images);v.value=E,s.value=E.emotions.map((N,R)=>({name:N.name,imageUrl:E.images[R]||""}))}catch(n){console.error("分析錯誤:",n),n instanceof TypeError&&n.message.includes("Failed to fetch")?u.value="無法連接到伺服器，請檢查網絡連接或稍後再試":u.value=n instanceof Error?n.message:"分析過程發生錯誤，請稍後再試"}finally{h.value=!1,g.value=!1,t.value=""}},speakEmotion:n=>{const r=new SpeechSynthesisUtterance(n);r.lang="en-US",r.rate=.8,speechSynthesis.speak(r)}}}}),Y={class:"row items-center q-mb-md"},G={class:"col"},K={key:0,class:"loading-section"},Z={class:"text-subtitle1 q-mt-md"},ee={key:1,class:"error-section"},se={key:2,class:"progress-section"},te={class:"text-subtitle1 text-center"},oe={key:3,class:"result-section"},ne={class:"emotion-cards row q-col-gutter-md"},ae={class:"text-h6"},re={class:"text-subtitle2"},ie={class:"text-body2"},le={class:"expression-section q-mt-xl"},ce=["innerHTML"],de={class:"row q-col-gutter-md"},ue={class:"col-12 col-md-6"},me={class:"text-center"},pe={key:0,class:"col-12 col-md-6"},he={class:"emotion-grid"},ge={class:"text-subtitle1 q-mt-sm"};function ve(e,s,h,u,v,g){return c(),$(H,{class:"q-pa-md"},{default:i(()=>[o("div",Y,[o("h1",G,[a(I,{name:"psychology",size:"md",color:"primary",class:"q-mr-sm"}),s[1]||(s[1]=x(" 今日回顧 | Daily Reflection "))])]),e.loading?(c(),d("div",K,[a(B,{color:"primary",size:"3em"}),o("p",Z,p(e.progressMessage),1)])):f("",!0),e.error?(c(),d("div",ee,[a(W,{class:"bg-negative text-white"},{default:i(()=>[x(p(e.error),1)]),_:1})])):f("",!0),e.showProgress?(c(),d("div",se,[a(J,{indeterminate:"",rounded:"",size:"md",color:"primary",class:"q-mb-sm"}),o("div",te,p(e.progressMessage),1)])):f("",!0),e.expressionResult?(c(),d("div",oe,[s[3]||(s[3]=o("h2",{class:"text-h4 q-mb-lg"},"故事情緒分析",-1)),o("div",ne,[(c(!0),d(Q,null,D(e.expressionResult.emotions,(t,l)=>(c(),d("div",{key:l,class:"col-12 col-sm-6 col-md-4"},[a(w,{class:"emotion-card"},{default:i(()=>[a(T,{src:e.expressionResult.images[l],ratio:1,class:"emotion-image"},null,8,["src"]),a(k,null,{default:i(()=>[o("div",ae,p(t.name),1),o("div",re,"強度: "+p(t.intensity)+"%",1),o("p",ie,p(t.description),1)]),_:2},1024)]),_:2},1024)]))),128))]),o("div",le,[a(w,{class:"expression-card"},{default:i(()=>[a(k,null,{default:i(()=>[s[2]||(s[2]=o("div",{class:"text-h5 q-mb-md"},"故事表達分析",-1)),o("div",{class:"text-body1",innerHTML:e.expressionResult.expression},null,8,ce)]),_:1})]),_:1})])])):f("",!0),o("div",de,[o("div",ue,[a(w,{class:"rpg-card"},{default:i(()=>[a(k,null,{default:i(()=>[s[4]||(s[4]=o("div",{class:"text-h6 q-mb-md"},"分享今天最深刻的經歷",-1)),a(L,{modelValue:e.userStory,"onUpdate:modelValue":s[0]||(s[0]=t=>e.userStory=t),type:"textarea",rows:"6",outlined:"",placeholder:`請用英文或中文描述...
Please describe in English or Chinese...`,class:"q-mb-md"},null,8,["modelValue"]),o("div",me,[a(P,{color:"primary",label:"分析情緒",loading:e.loading,onClick:e.analyzeEmotion,class:"rpg-button"},{loading:i(()=>[a(B)]),_:1},8,["loading","onClick"])])]),_:1})]),_:1})]),e.emotions.length>0?(c(),d("div",pe,[a(w,{class:"rpg-card"},{default:i(()=>[a(k,null,{default:i(()=>[s[5]||(s[5]=o("div",{class:"text-h6 q-mb-md"},"情緒分析結果",-1)),o("div",he,[(c(!0),d(Q,null,D(e.emotions,(t,l)=>(c(),d("div",{key:l,class:"emotion-item"},[a(T,{src:t.imageUrl,"spinner-color":"primary",style:{height:"200px","max-width":"200px"},class:"rounded-borders"},null,8,["src"]),o("div",ge,p(t.name),1),a(P,{flat:"",round:"",color:"primary",icon:"volume_up",onClick:q=>e.speakEmotion(t.name)},null,8,["onClick"])]))),128))])]),_:1})]),_:1})])):f("",!0)])]),_:1})}const Te=V(X,[["render",ve],["__scopeId","data-v-07ed5b8d"],["__file","PlaybackPage.vue"]]);export{Te as default};
