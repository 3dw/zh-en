import{a as V,Q as D,c as E,b as _}from"./QTabPanels-DVJzj7tU.js";import{X as O,r as m,b as L,_ as M,Z as o,$ as p,a0 as i,a1 as t,a4 as u,ag as N,aa as G,ab as n,ac as $,a2 as j,a3 as I,ad as h,a5 as f,a9 as v,a8 as Q,ae as P,ah as R,bl as X}from"./index-CJpG9EQv.js";import{Q as S}from"./QImg-BzzAM5GL.js";import{Q as Z}from"./QPage-6GT5Mf8N.js";import{g as H,s as J,r as K}from"./index.esm2017-CIO01KtW.js";import{u as W}from"./use-quasar-BhLJ6Pwr.js";import"./QResizeObserver-DUiAZIha.js";import"./rtl-DFPa-2ov.js";import"./use-panel-Dj8v9dk7.js";import"./touch-BjYP5sR0.js";import"./selection-OOmuBa9u.js";import"./use-ratio-CUFglyTp.js";import"./index.esm2017-ClwH-SB1.js";const Y=H(),x=O({name:"GalleryPage",props:{cards:{type:Array,default:()=>[]},user:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["earn-xp"],setup(e,{emit:s}){const b=W(),C=m(""),z=m("quiz"),B=r=>e.users.find(q=>q.uid===r)?.photoURL||"https://cdn.quasar.dev/img/boy-avatar.png",a=m({image:"https://via.placeholder.com/150",options:["選項1","選項2","選項3","選項4"],answer:"選項1"}),d=L(()=>{if(!C.value)return e.cards;const r=C.value.toLowerCase();return e.cards.filter(l=>l.description.toLowerCase().includes(r))}),y=r=>{if(r){const l=new SpeechSynthesisUtterance(r);l.lang="en-US",l.rate=.6,window.speechSynthesis.speak(l)}},T=r=>{if(window.confirm("確定要刪除這張卡片嗎？此動作無法復原。")){const l=e.cards.filter((q,w)=>w!==r);J(K(Y,"cards"),l)}},k=m(""),c=m(0),g=m(0),U=()=>{k.value===a.value.answer?(c.value++,g.value=0,s("earn-xp",c.value*100),b.notify({type:"positive",message:"答對了！您已連續答對 "+c.value+" 題，得到 "+c.value*100+"XP",position:"top",timeout:1500}),A()):(g.value++,c.value=0,b.notify({type:"negative",message:"答錯了！再試一次",position:"top",timeout:1500}),g.value>=2&&(g.value=0,A()))},A=()=>{if(!e.cards.length)return;const r=Math.floor(Math.random()*e.cards.length),l=e.cards[r];a.value.image=l.image,a.value.answer=l.description,k.value="";const w=e.cards.filter(F=>F.description!==l.description).sort(()=>Math.random()-.5).slice(0,3);a.value.options=[l.description,...w.map(F=>F.description)].sort(()=>Math.random()-.5)};return{getPhotoById:B,playCardAudio:y,deleteCard:T,searchQuery:C,filteredCards:d,quiz:a,selectedOption:k,checkAnswer:U,wins:c,tab:z,makeQuiz:A}}}),ee={class:"word-card-list"},ae={class:"search-bar q-mb-md"},se={class:"gallery-grid q-mt-lg flex flex-row-reverse flex-wrap-reverse"},te={class:"text-body1"},oe={class:"row q-mt-sm justify-between"},le={key:0,class:"text-body2"},re=["src"],ue={key:1,class:"text-body2"},ie={class:"word-card-list"},ne={class:"quiz-container"},de={key:0,class:"quiz-question"},ce={key:0},me={key:2,class:"quiz-options"};function pe(e,s,b,C,z,B){return o(),p(Z,{class:"q-pa-md"},{default:i(()=>[t(D,{modelValue:e.tab,"onUpdate:modelValue":s[0]||(s[0]=a=>e.tab=a),class:"text-grey"},{default:i(()=>[t(V,{name:"gallery",label:"AI 圖片描述畫廊"}),t(V,{name:"quiz",label:"4選1小測驗"})]),_:1},8,["modelValue"]),t(_,{modelValue:e.tab,"onUpdate:modelValue":s[4]||(s[4]=a=>e.tab=a),animated:""},{default:i(()=>[t(E,{name:"gallery"},{default:i(()=>[u("div",ee,[s[6]||(s[6]=u("h1",null,"AI 圖片描述畫廊",-1)),u("div",ae,[t(N,{modelValue:e.searchQuery,"onUpdate:modelValue":s[1]||(s[1]=a=>e.searchQuery=a),outlined:"",dense:"",placeholder:"搜尋圖片描述...",class:"search-input",clearable:""},{append:i(()=>[t(G,{name:"search"})]),_:1},8,["modelValue"])]),u("div",se,[(o(!0),n(P,null,$(e.filteredCards,(a,d)=>(o(),p(j,{key:d,class:"gallery-card q-ma-sm",flat:"",bordered:""},{default:i(()=>[t(S,{src:a.image,ratio:1,class:"gallery-image"},null,8,["src"]),t(I,null,{default:i(()=>[u("div",te,h(a.description),1),u("div",oe,[t(f,{color:"primary",icon:"volume_up",label:"播放發音",onClick:y=>e.playCardAudio(a.description),flat:""},null,8,["onClick"]),e.user&&e.user.isAdmin?(o(),p(f,{key:0,color:"negative",icon:"delete",label:"刪除",onClick:y=>e.deleteCard(d),flat:""},null,8,["onClick"])):v("",!0)])]),_:2},1024),t(I,null,{default:i(()=>[e.user&&e.user.isAdmin?(o(),n("div",le,[s[5]||(s[5]=Q(" upload by ")),u("img",{src:e.getPhotoById(a.createdBy||"未知"),class:"avatar"},null,8,re),Q(" "+h((a.createdAt||"未知").split("T")[0]),1)])):(o(),n("div",ue," upload at "+h((a.createdAt||"未知").split("T")[0]),1))]),_:2},1024)]),_:2},1024))),128))])])]),_:1}),t(E,{name:"quiz"},{default:i(()=>[u("div",ie,[u("div",ne,[e.quiz.image!=="https://via.placeholder.com/150"?(o(),n("div",de,[u("h2",null,[s[7]||(s[7]=Q(" 這是什麼？")),e.wins>0?(o(),n("span",ce," - 連續答對 "+h(e.wins)+" 題",1)):v("",!0)]),t(S,{src:e.quiz.image,ratio:1,class:"quiz-image"},null,8,["src"]),t(f,{color:"primary",icon:"volume_up",label:"播放發音",onClick:s[2]||(s[2]=a=>e.playCardAudio(e.quiz.answer)),flat:""})])):v("",!0),e.quiz.image!=="https://via.placeholder.com/150"?(o(),p(R,{key:1})):v("",!0),e.quiz.image!=="https://via.placeholder.com/150"?(o(),n("div",me,[(o(!0),n(P,null,$(e.quiz.options,(a,d)=>(o(),n("div",{key:d,class:"quiz-option"},[t(X,{modelValue:e.selectedOption,"onUpdate:modelValue":s[3]||(s[3]=y=>e.selectedOption=y),val:a,label:a},null,8,["modelValue","val","label"])]))),128)),t(f,{color:"primary",icon:"check",label:"檢查答案",onClick:e.checkAnswer},null,8,["onClick"])])):v("",!0),e.quiz.image=="https://via.placeholder.com/150"?(o(),p(f,{key:3,color:"primary",size:"xl",icon:"refresh",label:"開始出題！",onClick:e.makeQuiz},null,8,["onClick"])):(o(),p(f,{key:4,color:"primary",icon:"refresh",label:"重新出題！",onClick:e.makeQuiz,flat:""},null,8,["onClick"]))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ze=M(x,[["render",pe],["__scopeId","data-v-cc6912dc"],["__file","GalleryPage.vue"]]);export{ze as default};
