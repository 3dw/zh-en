import{a as V,Q as J,c as Q,b as Z}from"./QTabPanels-BjYzlk7t.js";import{X as z,r as i,H as j,w as L,_ as R,Y as H,Z as F,$ as M,a0 as u,a4 as c,a1 as l,ah as U,I as v,ax as I,a5 as m,ab as N,aa as W,a2 as X,a3 as $,a8 as Y,aq as G,a7 as K}from"./index-Dy36b27O.js";import{Q as x}from"./QForm-BQHvEEOr.js";import{Q as _}from"./QPage-DiUrNdKm.js";import{C as O}from"./ClosePopup-BkS2fj8p.js";import{F as ee}from"./FlashCard-BoTnXM7U.js";import{g as ae,o as se}from"./index-ea1a36e4-yErB6TnM.js";import"./index.esm2017-ClwH-SB1.js";import{g as le,r as P,a as oe,s as T}from"./index.esm2017-CFsHUG3Y.js";import"./touch-xoXZ17mx.js";import"./rtl-DFPa-2ov.js";import"./selection--H6lu_3n.js";const te=z({name:"CustomCardsPage",components:{FlashCard:ee},setup(){const s=i("create"),e=i([]),d=i([]),t=i({english:"",chinese:"",flipped:!1}),w=i(!1),g=i(-1),h=ae(),o=le(),C=i(h.currentUser),b=i(!1),q=i(!1);j(()=>{b.value=!0,se(h,async a=>{C.value=a,a?(console.log("user",a),console.log("user.uid",a.uid),await D(a.uid)):A(),b.value=!1})}),L(C,async a=>{a?(console.log("newUser",a),console.log("newUser.uid",a.uid),await D(a.uid)):A()});const A=()=>{const a=localStorage.getItem("customCards");a&&(e.value=JSON.parse(a),d.value=Array(e.value.length).fill(!1))},D=async a=>{console.log("syncUserData",a);try{const n=localStorage.getItem("customCards"),r=n?JSON.parse(n):[],y=P(o,`users/${a}/customCards`),S=await oe(y),p=S.exists()?S.val():[];if(r.length>0&&p.length===0)await T(y,r),e.value=r;else if(r.length===0&&p.length>0)localStorage.setItem("customCards",JSON.stringify(p)),e.value=p;else if(r.length>0&&p.length>0){const f=[...p];for(const B of r)f.some(k=>k.english===B.english&&k.chinese===B.chinese)||f.push(B);await T(y,f),localStorage.setItem("customCards",JSON.stringify(f)),e.value=f}d.value=Array(e.value.length).fill(!1)}catch(n){console.error("同步用戶資料失敗:",n)}},E=async()=>{if(localStorage.setItem("customCards",JSON.stringify(e.value)),C.value)try{const a=P(o,`users/${C.value.uid}/customCards`);await T(a,e.value)}catch(a){console.error("保存到 Firebase 失敗:",a)}};return{activeTab:s,customCards:e,flippedCards:d,newCard:t,showDeleteDialog:w,currentUser:C,isLoading:b,synced:q,createCard:()=>{!t.value.english||!t.value.chinese||(e.value.push({english:t.value.english,chinese:t.value.chinese,flipped:!1}),d.value.push(!1),E(),t.value={english:"",chinese:"",flipped:!1},s.value="view")},flipCard:a=>{d.value[a]=!d.value[a]},confirmDelete:a=>{g.value=a,w.value=!0},deleteCard:()=>{g.value!==-1&&window.confirm("確定要刪除這張字卡嗎？此操作無法復原。")&&(e.value.splice(g.value,1),d.value.splice(g.value,1),E())},speakText:(a,n="en-US")=>{if(a){const r=new SpeechSynthesisUtterance(a);r.lang=n,r.rate=.8,window.speechSynthesis.speak(r)}},autoTranslateZhToEn:async()=>{try{const n=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t.value.chinese})})).json();console.log(n),t.value.english=n||"",console.log("newCard.value.english",t.value.english)}catch(a){console.error("翻譯失敗:",a)}},autoTranslateEnToZh:async()=>{try{const n=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-en-to-zh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t.value.english})})).json();console.log(n),t.value.chinese=n||"",console.log("newCard.value.chinese",t.value.chinese)}catch(a){console.error("翻譯失敗:",a)}}}}}),ne={class:"word-card-list"},ue={class:"row justify-between q-mt-lg"},re={key:0,class:"text-center q-pa-lg"},ie={key:1};function de(s,e,d,t,w,g){const h=H("FlashCard");return F(),M(_,{class:"q-pa-md"},{default:u(()=>[c("div",ne,[e[11]||(e[11]=c("h1",{class:"page-title"},"自訂字卡",-1)),l(J,{modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=o=>s.activeTab=o),class:"text-primary q-mb-lg"},{default:u(()=>[l(V,{name:"create",label:"新增字卡",icon:"add_circle"}),l(V,{name:"view",label:"我的字卡",icon:"list"})]),_:1},8,["modelValue"]),l(Z,{modelValue:s.activeTab,"onUpdate:modelValue":e[5]||(e[5]=o=>s.activeTab=o),animated:""},{default:u(()=>[l(Q,{name:"create"},{default:u(()=>[e[7]||(e[7]=c("div",{class:"text-h6 q-mb-md"},"新增自訂字卡",-1)),l(x,{onSubmit:s.createCard,class:"q-gutter-md"},{default:u(()=>[l(U,{modelValue:s.newCard.english,"onUpdate:modelValue":e[1]||(e[1]=o=>s.newCard.english=o),label:"英文單字或句子",rules:[o=>!!o||"請輸入英文內容"],outlined:"",class:"large-input",type:"textarea"},null,8,["modelValue","rules"]),l(U,{modelValue:s.newCard.chinese,"onUpdate:modelValue":e[2]||(e[2]=o=>s.newCard.chinese=o),label:"中文翻譯",rules:[o=>!!o||"請輸入中文翻譯"],outlined:"",class:"large-input",type:"textarea"},null,8,["modelValue","rules"]),v(l(m,{icon:"language",label:"自動英翻中",color:"primary",onClick:s.autoTranslateEnToZh},null,8,["onClick"]),[[I,s.newCard.english&&!s.newCard.chinese]]),v(l(m,{icon:"language",label:"自動中翻英",color:"primary",onClick:s.autoTranslateZhToEn},null,8,["onClick"]),[[I,s.newCard.chinese&&!s.newCard.english]]),c("div",ue,[l(m,{icon:"volume_up",color:"secondary",label:"英文發音測試",onClick:e[3]||(e[3]=o=>s.speakText(s.newCard.english,"en-US")),disable:!s.newCard.english},null,8,["disable"]),l(m,{icon:"volume_up",color:"green-8",label:"中文發音測試",onClick:e[4]||(e[4]=o=>s.speakText(s.newCard.chinese,"zh-TW")),disable:!s.newCard.chinese},null,8,["disable"]),l(m,{type:"submit",color:"primary",label:"新增字卡",icon:"save"})])]),_:1},8,["onSubmit"])]),_:1}),l(Q,{name:"view"},{default:u(()=>[e[10]||(e[10]=c("div",{class:"text-h6 q-mb-md"},"我的自訂字卡",-1)),s.customCards.length===0?(F(),N("div",re,[l(W,{name:"info",size:"50px",color:"grey-5"}),e[8]||(e[8]=c("p",{class:"text-grey-7"},"還沒有自訂字卡",-1)),e[9]||(e[9]=c("p",{class:"text-grey-7"},"請切換到「新增字卡」頁籤來創建",-1))])):(F(),N("div",ie,[l(h,{sentences:s.customCards},null,8,["sentences"])]))]),_:1})]),_:1},8,["modelValue"])]),l(K,{modelValue:s.showDeleteDialog,"onUpdate:modelValue":e[6]||(e[6]=o=>s.showDeleteDialog=o)},{default:u(()=>[l(X,null,{default:u(()=>[l($,{class:"row items-center"},{default:u(()=>e[12]||(e[12]=[c("div",{class:"text-h6"},"確認刪除",-1)])),_:1}),l($,null,{default:u(()=>e[13]||(e[13]=[Y(" 確定要刪除這張字卡嗎？此操作無法復原。 ")])),_:1}),l(G,{align:"right"},{default:u(()=>[v(l(m,{flat:"",label:"取消",color:"primary"},null,512),[[O]]),v(l(m,{flat:"",label:"刪除",color:"negative",onClick:s.deleteCard},null,8,["onClick"]),[[O]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Qe=R(te,[["render",de],["__scopeId","data-v-73d500ff"],["__file","CustomCardsPage.vue"]]);export{Qe as default};
