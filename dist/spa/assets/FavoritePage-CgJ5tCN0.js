import{Q as q,a as ae,b as Q,c as se}from"./QTabPanels-DtnB6UCU.js";import{a3 as ue,r as c,O as ie,b as re,n as ce,w as U,a4 as de,a5 as pe,a6 as r,a7 as K,a8 as C,ac as s,a9 as n,ak as d,A as z,ag as B,aj as w,ad as m,y as ve,z as me,ah as $,an as W,am as he,al as fe,aq as ge,aB as Ce}from"./index-u7gP2akL.js";import{Q as ye}from"./QPage-CLiibsKN.js";import{u as ke}from"./use-quasar-96ZBGOZf.js";import{F as we}from"./FlashCard-DDNvS-7o.js";import"./touch-DKFnPjvj.js";import"./rtl-DFPa-2ov.js";import"./selection-BDEOF8pu.js";const Fe=ue({name:"FavoritePage",components:{FlashCard:we},setup(e,{emit:l}){const f=ke(),i=c([]),F=c(!1),A=c([]),g=c(null),u=c(!1);ie(()=>{const o=localStorage.getItem("en_love_arr");console.log(o);function t(a){return a.map(D=>({chinese:D.chinese,english:D.english,flipped:!1}))}o&&(i.value=t(JSON.parse(o)),O()),i.value.length>=4&&(S(),E.value="multipleChoice")});const b=o=>{i.value=i.value.filter(t=>!(t.english===o.english&&t.chinese===o.chinese)),localStorage.setItem("favoriteCards",JSON.stringify(i.value))},E=c("view"),v=c(null),y=c(null),T=c(""),k=c(""),V=c(!1),p=c(0),G=re(()=>v.value?v.value.english.split(" "):[]);function X(o){o?(p.value++,f.notify({type:"positive",message:`答對了！您已連續答對${p.value}題！獲得100xp！`,position:"top",timeout:2500}),F.value=!1,u.value=!1,P()):(p.value=0,f.notify({type:"negative",message:"不太像，再試一次！",position:"top",timeout:2500}))}function O(){if(i.value.length===0){v.value=null;return}const o=Math.floor(Math.random()*i.value.length);v.value=i.value[o];const t=v.value.english.split(" ");t.length===0?y.value=null:y.value=Math.floor(Math.random()*t.length),T.value="",k.value="",V.value=!1,ce(()=>{const a=document.querySelector("input");a&&a.focus()})}function _(){if(!v.value||y.value===null)return;const o=v.value.english.split(" "),t=y.value!==null&&o[y.value]||"",a=T.value.trim().toLowerCase().replace(/[.,!?;:]/g,""),D=t.trim().toLowerCase().replace(/[.,!?;:]/g,"");a===D?(p.value++,k.value="答對了！您已連續答對"+p.value+"題！",f.notify({type:"positive",message:k.value,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]}),l("earn-xp",50)):(k.value=`答錯了，正確答案是：${t}`,p.value=0,f.notify({type:"negative",message:k.value,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]})),V.value=!0;const J=te=>{te.key==="Enter"&&(I(),document.removeEventListener("keydown",J))};document.addEventListener("keydown",J)}function I(){O()}function H(){const o=new SpeechSynthesisUtterance(v.value?.english);window.speechSynthesis.speak(o)}function Y(){const o=new SpeechSynthesisUtterance(M.value?.english);window.speechSynthesis.speak(o)}U(E,o=>{o==="cloze"&&O()});const h=c(null),N=c([]),R=c(null);function S(){if(i.value.length<4){h.value=null;return}const o=Math.floor(Math.random()*i.value.length);h.value=i.value[o],Z()}function Z(){if(!h.value)return;const o=h.value.english,t=i.value.filter(a=>a.english!==o).map(a=>a.english).sort(()=>Math.random()-.5).slice(0,3);N.value=[{label:o,value:o},...t.map(a=>({label:a,value:a}))].sort(()=>Math.random()-.5)}function x(){R.value===h.value?.english?(p.value++,f.notify({type:"positive",message:`答對了！您已連續答對${p.value}題！獲得100xp！`,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]}),l("earn-xp",100)):(p.value=0,f.notify({type:"negative",message:`答錯了，正確答案是：${h.value?.english}`,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]})),S()}function ee(){S()}U(E,o=>{o==="multipleChoice"?S():o==="speakout"&&P()});const M=c({chinese:"",english:"",flipped:!1});function P(){if(i.value.length===0){M.value=i.value[0];return}const o=Math.floor(Math.random()*i.value.length);M.value=i.value[o],L.value=""}function oe(){const o=new SpeechSynthesisUtterance(h.value?.english);window.speechSynthesis.speak(o)}U(R,o=>{if(o){const t=new SpeechSynthesisUtterance(o);window.speechSynthesis.speak(t)}});const L=c("");async function le(){try{const o=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(o);A.value=[],t.start(),F.value=!0,console.log("錄音開始"),t.ondataavailable=a=>{console.log("錄音中"),console.log(a.data),A.value.push(a.data),j()},t.onstop=()=>{F.value=!1,console.log("錄音結束"),o.getTracks().forEach(a=>a.stop())},setTimeout(()=>{t.stop(),u.value=!0},5e3)}catch(o){console.error("錄音失敗:",o)}}async function j(){const o=new Blob(A.value,{type:"audio/mp4"});new FormData().append("file",o,"recording.mp4");const a=URL.createObjectURL(o);g.value&&(g.value.src=a)}function ne(){g.value&&(g.value.src="",u.value=!1)}return{favoriteCards:i,removeFromFavorites:b,activeTab:E,currentCard:M,currentClozeCard:v,blankIndex:y,userAnswer:T,feedback:k,answered:V,correctCount:p,splitEnglishSentence:G,checkAnswer:_,nextQuestion:I,playAudio:H,playSpeakoutAudio:Y,isRecording:F,hasRecorded:u,audioChunks:A,currentMultipleChoiceCard:h,multipleChoiceOptions:N,selectedOption:R,checkMultipleChoiceAnswer:x,nextMultipleChoiceQuestion:ee,playMultipleChoiceAudio:oe,startRecording:le,uploadAudio:j,recordedText:L,audioPlayer:g,checkAnswerSpeakoutAnswer:X,resetAudio:ne}}}),Ae={class:"q-pa-md full-width"},be={key:0,class:"text-center q-pa-lg"},Be={key:1},Ee={key:0,class:"text-center q-pa-lg"},Se={key:1},Me={class:"q-mt-md"},De={key:1,class:"text-red-7"},qe={ref:"audioPlayer",controls:""},Qe={key:2,class:"q-mt-md"},ze={key:0,class:"text-center q-pa-lg"},Te={key:1,class:"q-pa-md"},Ve={key:0},Oe={key:0,style:{color:"red"}},Re={class:"q-mt-md"},Ue={class:"q-mt-md"},$e={class:"q-mt-md"},Ie={key:0,class:"text-center q-pa-lg"},Ne={key:1,class:"q-pa-md"},Pe={key:0},Le={class:"q-mt-md"},je={class:"q-mt-md"};function Je(e,l,f,i,F,A){const g=pe("FlashCard");return r(),K(ye,{class:"flex flex-center"},{default:C(()=>[s("div",Ae,[l[15]||(l[15]=s("h2",null,"我的最愛字卡",-1)),n(ae,{modelValue:e.activeTab,"onUpdate:modelValue":l[0]||(l[0]=u=>e.activeTab=u),dense:"","border-color":"primary",class:"q-mb-md"},{default:C(()=>[n(q,{name:"view",label:"卡片"}),n(q,{name:"cloze",label:"克漏字"}),n(q,{name:"multipleChoice",label:"四選一"}),n(q,{name:"speakout",label:"開口說"})]),_:1},8,["modelValue"]),n(se,{modelValue:e.activeTab,"onUpdate:modelValue":l[7]||(l[7]=u=>e.activeTab=u),animated:""},{default:C(()=>[n(Q,{name:"view"},{default:C(()=>[e.favoriteCards.length===0?(r(),d("div",be,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[8]||(l[8]=s("p",{class:"text-grey-7"},"還沒有收藏的字卡",-1)),l[9]||(l[9]=s("p",{class:"text-grey-7"},"在學習時點擊愛心圖示來收藏字卡",-1))])):(r(),d("div",Be,[n(g,{sentences:e.favoriteCards,onEarnXp:l[1]||(l[1]=u=>e.$emit("earn-xp",u))},null,8,["sentences"])]))]),_:1}),n(Q,{name:"speakout"},{default:C(()=>[e.favoriteCards.length===0?(r(),d("div",Ee,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[10]||(l[10]=s("p",{class:"text-grey-7"},"還沒有收藏的字卡",-1))])):(r(),d("div",Se,[s("div",Me,[s("h2",null,[B(" 中文："+w(e.currentCard.chinese)+" ",1),l[11]||(l[11]=s("br",null,null,-1)),B(" 英文："+w(e.currentCard.english)+" ",1),n(m,{icon:"volume_up",size:"lg",color:"primary",onClick:e.playSpeakoutAudio,flat:""},null,8,["onClick"])]),e.isRecording?(r(),d("span",De,"錄音中...")):(r(),K(m,{key:0,icon:"mic",size:"lg",color:"primary",onClick:e.startRecording,flat:""},null,8,["onClick"])),ve(s("audio",qe,null,512),[[me,!e.isRecording&&e.hasRecorded]]),!e.isRecording&&e.hasRecorded?(r(),d("div",Qe,[n(m,{color:"primary",label:"很棒！下一題",onClick:l[2]||(l[2]=u=>e.checkAnswerSpeakoutAnswer(!0))}),n(m,{color:"secondary",label:"再試一次",onClick:l[3]||(l[3]=u=>e.checkAnswerSpeakoutAnswer(!1))})])):$("",!0)])]))]),_:1}),n(Q,{name:"cloze"},{default:C(()=>[e.favoriteCards.length===0?(r(),d("div",ze,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[12]||(l[12]=s("p",{class:"text-grey-7"},"還沒有收藏的字卡，無法進行克漏字練習",-1))])):(r(),d("div",Te,[e.currentClozeCard?(r(),d("div",Ve,[s("h2",null,[B(" 中文："+w(e.currentClozeCard.chinese)+" ",1),n(m,{icon:"volume_up",size:"lg",color:"primary",onClick:e.playAudio,flat:""},null,8,["onClick"])]),l[13]||(l[13]=s("h2",null,"英文：",-1)),s("p",null,[(r(!0),d(W,null,he(e.splitEnglishSentence,(u,b)=>(r(),d("span",{key:b},[b===e.blankIndex?(r(),d("span",Oe,"_______")):(r(),d(W,{key:1},[B(w(u),1)],64)),B(" "+w(b<e.splitEnglishSentence.length-1?" ":""),1)]))),128))]),s("div",Re,[n(fe,{autofocus:!0,modelValue:e.userAnswer,"onUpdate:modelValue":l[4]||(l[4]=u=>e.userAnswer=u),label:"請填入缺少的單字",disable:e.answered,onKeydown:l[5]||(l[5]=ge(u=>!e.answered&&e.userAnswer&&e.checkAnswer(),["enter"])),class:"large-input"},null,8,["modelValue","disable"])]),s("div",Ue,[n(m,{color:"primary",label:"檢查答案",onClick:e.checkAnswer,disable:e.answered||!e.userAnswer},null,8,["onClick","disable"])]),s("div",$e,[n(m,{color:"secondary",label:"下一題",onClick:e.nextQuestion},null,8,["onClick"])])])):$("",!0)]))]),_:1}),n(Q,{name:"multipleChoice"},{default:C(()=>[e.favoriteCards.length<4?(r(),d("div",Ie,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[14]||(l[14]=s("p",{class:"text-grey-7"},"收藏的字卡不足以進行四選一測驗，請收藏更多字卡",-1))])):(r(),d("div",Ne,[e.currentMultipleChoiceCard?(r(),d("div",Pe,[s("h2",null," 中文："+w(e.currentMultipleChoiceCard.chinese),1),n(Ce,{modelValue:e.selectedOption,"onUpdate:modelValue":l[6]||(l[6]=u=>e.selectedOption=u),options:e.multipleChoiceOptions,type:"radio"},null,8,["modelValue","options"]),s("div",Le,[n(m,{color:"primary",label:"檢查答案",onClick:e.checkMultipleChoiceAnswer,disable:!e.selectedOption},null,8,["onClick","disable"])]),s("div",je,[n(m,{color:"secondary",label:"下一題",onClick:e.nextMultipleChoiceQuestion},null,8,["onClick"])])])):$("",!0)]))]),_:1})]),_:1},8,["modelValue"])])]),_:1})}const xe=de(Fe,[["render",Je],["__scopeId","data-v-ed2e252d"],["__file","FavoritePage.vue"]]);export{xe as default};
