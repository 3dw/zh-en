import{a as V,Q as D,c as E,b as O}from"./QTabPanels-C2_AHW4T.js";import{a3 as _,r as m,b as L,a4 as M,a6 as l,a7 as p,a8 as i,a9 as t,ac as u,an as N,A as j,ai as n,aj as I,aa as G,ab as P,ak as h,ad as f,ah as v,ag as F,al as $,Q as R,bl as X}from"./index-BTiaktO6.js";import{Q as S}from"./QImg-hrdLeJIL.js";import{Q as H}from"./QPage-dCvdD5ep.js";import{g as J,s as K,r as W}from"./index.esm2017-CFsHUG3Y.js";import{u as Y}from"./use-quasar-vv55PxmG.js";import"./touch-CT1YOeb5.js";import"./rtl-DFPa-2ov.js";import"./selection-B8zZQE7S.js";import"./index.esm2017-ClwH-SB1.js";const Z=J(),x=_({name:"GalleryPage",props:{cards:{type:Array,default:()=>[]},user:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["earn-xp"],setup(e,{emit:s}){const b=Y(),C=m(""),z=m("quiz"),B=r=>e.users.find(q=>q.uid===r)?.photoURL||"https://cdn.quasar.dev/img/boy-avatar.png",a=m({image:"https://via.placeholder.com/150",options:["選項1","選項2","選項3","選項4"],answer:"選項1"}),d=L(()=>{if(!C.value)return e.cards;const r=C.value.toLowerCase();return e.cards.filter(o=>o.description.toLowerCase().includes(r))}),y=r=>{if(r){const o=new SpeechSynthesisUtterance(r);o.lang="en-US",o.rate=.6,window.speechSynthesis.speak(o)}},T=r=>{if(window.confirm("確定要刪除這張卡片嗎？此動作無法復原。")){const o=e.cards.filter((q,w)=>w!==r);K(W(Z,"cards"),o)}},k=m(""),c=m(0),g=m(0),U=()=>{k.value===a.value.answer?(c.value++,g.value=0,s("earn-xp",c.value*100),b.notify({type:"positive",message:"答對了！您已連續答對 "+c.value+" 題，得到 "+c.value*100+"XP",position:"top",timeout:1500}),A()):(g.value++,c.value=0,b.notify({type:"negative",message:"答錯了！再試一次",position:"top",timeout:1500}),g.value>=2&&(g.value=0,A()))},A=()=>{if(!e.cards.length)return;const r=Math.floor(Math.random()*e.cards.length),o=e.cards[r];a.value.image=o.image,a.value.answer=o.description,k.value="";const w=e.cards.filter(Q=>Q.description!==o.description).sort(()=>Math.random()-.5).slice(0,3);a.value.options=[o.description,...w.map(Q=>Q.description)].sort(()=>Math.random()-.5)};return{getPhotoById:B,playCardAudio:y,deleteCard:T,searchQuery:C,filteredCards:d,quiz:a,selectedOption:k,checkAnswer:U,wins:c,tab:z,makeQuiz:A}}}),ee={class:"word-card-list"},ae={class:"search-bar q-mb-md"},se={class:"gallery-grid q-mt-lg flex flex-row-reverse flex-wrap-reverse"},te={class:"text-body1"},le={class:"row q-mt-sm justify-between"},oe={key:0,class:"text-body2"},re=["src"],ue={key:1,class:"text-body2"},ie={class:"word-card-list"},ne={class:"quiz-container"},de={key:0,class:"quiz-question"},ce={key:0},me={key:2,class:"quiz-options"};function pe(e,s,b,C,z,B){return l(),p(H,{class:"q-pa-md"},{default:i(()=>[t(D,{modelValue:e.tab,"onUpdate:modelValue":s[0]||(s[0]=a=>e.tab=a),class:"text-grey"},{default:i(()=>[t(V,{name:"gallery",label:"AI 圖片描述畫廊"}),t(V,{name:"quiz",label:"4選1小測驗"})]),_:1},8,["modelValue"]),t(O,{modelValue:e.tab,"onUpdate:modelValue":s[4]||(s[4]=a=>e.tab=a),animated:""},{default:i(()=>[t(E,{name:"gallery"},{default:i(()=>[u("div",ee,[s[6]||(s[6]=u("h1",null,"AI 圖片描述畫廊",-1)),u("div",ae,[t(N,{modelValue:e.searchQuery,"onUpdate:modelValue":s[1]||(s[1]=a=>e.searchQuery=a),outlined:"",dense:"",placeholder:"搜尋圖片描述...",class:"search-input",clearable:""},{append:i(()=>[t(j,{name:"search"})]),_:1},8,["modelValue"])]),u("div",se,[(l(!0),n($,null,I(e.filteredCards,(a,d)=>(l(),p(G,{key:d,class:"gallery-card q-ma-sm",flat:"",bordered:""},{default:i(()=>[t(S,{src:a.image,ratio:1,class:"gallery-image"},null,8,["src"]),t(P,null,{default:i(()=>[u("div",te,h(a.description),1),u("div",le,[t(f,{color:"primary",icon:"volume_up",label:"播放發音",onClick:y=>e.playCardAudio(a.description),flat:""},null,8,["onClick"]),e.user&&e.user.isAdmin?(l(),p(f,{key:0,color:"negative",icon:"delete",label:"刪除",onClick:y=>e.deleteCard(d),flat:""},null,8,["onClick"])):v("",!0)])]),_:2},1024),t(P,null,{default:i(()=>[e.user&&e.user.isAdmin?(l(),n("div",oe,[s[5]||(s[5]=F(" upload by ")),u("img",{src:e.getPhotoById(a.createdBy||"未知"),class:"avatar"},null,8,re),F(" "+h((a.createdAt||"未知").split("T")[0]),1)])):(l(),n("div",ue," upload at "+h((a.createdAt||"未知").split("T")[0]),1))]),_:2},1024)]),_:2},1024))),128))])])]),_:1}),t(E,{name:"quiz"},{default:i(()=>[u("div",ie,[u("div",ne,[e.quiz.image!=="https://via.placeholder.com/150"?(l(),n("div",de,[u("h2",null,[s[7]||(s[7]=F(" 這是什麼？")),e.wins>0?(l(),n("span",ce," - 連續答對 "+h(e.wins)+" 題",1)):v("",!0)]),t(S,{src:e.quiz.image,ratio:1,class:"quiz-image"},null,8,["src"]),t(f,{color:"primary",icon:"volume_up",label:"播放發音",onClick:s[2]||(s[2]=a=>e.playCardAudio(e.quiz.answer)),flat:""})])):v("",!0),e.quiz.image!=="https://via.placeholder.com/150"?(l(),p(R,{key:1})):v("",!0),e.quiz.image!=="https://via.placeholder.com/150"?(l(),n("div",me,[(l(!0),n($,null,I(e.quiz.options,(a,d)=>(l(),n("div",{key:d,class:"quiz-option"},[t(X,{modelValue:e.selectedOption,"onUpdate:modelValue":s[3]||(s[3]=y=>e.selectedOption=y),val:a,label:a},null,8,["modelValue","val","label"])]))),128)),t(f,{color:"primary",icon:"check",label:"檢查答案",onClick:e.checkAnswer},null,8,["onClick"])])):v("",!0),e.quiz.image=="https://via.placeholder.com/150"?(l(),p(f,{key:3,color:"primary",size:"xl",icon:"refresh",label:"開始出題！",onClick:e.makeQuiz},null,8,["onClick"])):(l(),p(f,{key:4,color:"primary",icon:"refresh",label:"重新出題！",onClick:e.makeQuiz,flat:""},null,8,["onClick"]))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const we=M(x,[["render",pe],["__scopeId","data-v-cc6912dc"],["__file","GalleryPage.vue"]]);export{we as default};
