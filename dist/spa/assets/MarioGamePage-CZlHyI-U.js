import{X as V,r,H as W,V as Y,_ as $,Z as j,$ as q,a0 as g,a4 as n,a1 as u,aa as T,a8 as U,ad as G,a5 as A,a2 as J,a3 as O,ar as N,aq as H,I as z,a7 as X}from"./index-BRRbmYHv.js";import{Q as Z}from"./QPage-B7rSGgDX.js";import{C as ee}from"./ClosePopup-DIQ3H05e.js";const ae=V({name:"MarioGamePage",setup(){const t=r(null),a=r(null),h=r(0),d=r(!1),m=r(!1),f=r(null),i=r({mario:{x:100,y:400,width:32,height:32,type:"mario"},mushrooms:[],platforms:[{x:0,y:450,width:800,height:50,type:"platform"}],currentWord:"",targetWord:""}),_=[{word:"cat",translation:"貓"},{word:"dog",translation:"狗"},{word:"bird",translation:"鳥"},{word:"fish",translation:"魚"},{word:"tree",translation:"樹"}],y={gravity:.5,jumpForce:-12,moveSpeed:5},o=r({velocityY:0,isJumping:!1,direction:1,isMovingLeft:!1,isMovingRight:!1}),b=r([{x:100,y:50,width:80,height:40},{x:300,y:70,width:100,height:50},{x:600,y:40,width:90,height:45}]),F=r([{x:500,y:370,width:60,height:80},{x:700,y:350,width:60,height:100}]),M=r([{x:200,y:200,width:40,height:40},{x:240,y:200,width:40,height:40},{x:280,y:200,width:40,height:40},{x:400,y:250,width:40,height:40},{x:440,y:250,width:40,height:40}]),s={jump:new Audio("/sounds/jump_11.wav"),coin:new Audio("/sounds/coin.aif"),gameover:new Audio("/sounds/mario-die.mp3"),background:new Audio("/sounds/mario-theme.mp3")};s.background.loop=!0,s.background.volume=.5;const B=()=>{t.value&&(t.value.width=800,t.value.height=500,a.value=t.value.getContext("2d"),a.value&&(a.value.imageSmoothingEnabled=!1))},S=()=>{const e=[],v=[..._],l=Math.floor(Math.random()*v.length),w=v[l];if(w){i.value.targetWord=w.word,i.value.currentWord=w.translation;for(let c=0;c<3;c++){const R=c===l?w.word:v[(c+1)%v.length]?.word;R&&e.push({x:200+c*200,y:200,width:32,height:32,type:"mushroom",word:R,isCorrect:c===l})}i.value.mushrooms=e}},P=()=>{a.value&&i.value.mushrooms.forEach(e=>{a.value.fillStyle=e.isCorrect?"#4CAF50":"#FFA000",a.value.fillRect(e.x,e.y,e.width,e.height),a.value.fillStyle="#000",a.value.font="14px Arial",a.value.textAlign="center",a.value.fillText(e.word||"",e.x+e.width/2,e.y-5)})},D=()=>{if(!a.value)return;const e=i.value.mario;a.value.fillStyle="#ff0000",a.value.fillRect(e.x,e.y,e.width,e.height)},L=()=>{a.value&&(a.value.fillStyle="#000",a.value.font="24px Arial",a.value.textAlign="center",a.value.fillText(`找出 "${i.value.currentWord}" 的英文: ${i.value.targetWord}`,400,50))},Q=()=>{a.value&&(a.value.clearRect(0,0,800,500),a.value.fillStyle="#87CEEB",a.value.fillRect(0,0,800,500),a.value.fillStyle="#FFFFFF",b.value.forEach(e=>{a.value.beginPath(),a.value.arc(e.x,e.y,20,0,Math.PI*2),a.value.arc(e.x+15,e.y-10,15,0,Math.PI*2),a.value.arc(e.x+30,e.y,20,0,Math.PI*2),a.value.fill()}),a.value.fillStyle="#8B4513",a.value.fillRect(0,450,800,50),a.value.fillStyle="#B87333",M.value.forEach(e=>{a.value.fillRect(e.x,e.y,e.width,e.height),a.value.strokeStyle="#8B4513",a.value.strokeRect(e.x,e.y,e.width,e.height)}),a.value.fillStyle="#00FF00",F.value.forEach(e=>{a.value.fillRect(e.x,e.y,e.width,e.height),a.value.fillStyle="#00CC00",a.value.fillRect(e.x-5,e.y,5,10),a.value.fillRect(e.x+e.width,e.y,5,10)}),P(),D(),L())},K=()=>{if(!d.value)return;const e=i.value.mario;o.value.isMovingLeft&&(e.x-=y.moveSpeed),o.value.isMovingRight&&(e.x+=y.moveSpeed),e.x=Math.max(0,Math.min(e.x,800-e.width)),o.value.velocityY+=y.gravity,e.y+=o.value.velocityY;const v=l=>{e.y+e.height>l.y&&e.y<l.y+l.height&&e.x+e.width>l.x&&e.x<l.x+l.width&&o.value.velocityY>0&&(e.y=l.y-e.height,o.value.velocityY=0,o.value.isJumping=!1)};i.value.platforms.forEach(v),M.value.forEach(v),F.value.forEach(v),i.value.mushrooms.forEach(l=>{e.y+e.height>l.y&&e.y<l.y+l.height&&e.x+e.width>l.x&&e.x<l.x+l.width&&(l.isCorrect?(h.value+=100,s.coin.currentTime=0,s.coin.play(),S()):(m.value=!0,s.gameover.play(),p()))})},k=()=>{K(),Q(),f.value=requestAnimationFrame(k)},E=()=>{d.value||(d.value=!0,h.value=0,S(),f.value=requestAnimationFrame(k),t.value&&t.value.focus(),s.background.play())},p=()=>{d.value=!1,f.value&&cancelAnimationFrame(f.value),s.background.pause(),s.background.currentTime=0},I=()=>{p(),i.value.mario.x=100,i.value.mario.y=400,o.value.velocityY=0,o.value.isJumping=!1,h.value=0,m.value=!1,E()},x=e=>{if(d.value)switch(e.code){case"Space":o.value.isJumping||(o.value.velocityY=y.jumpForce,o.value.isJumping=!0,s.jump.currentTime=0,s.jump.play());break;case"ArrowLeft":o.value.isMovingLeft=!0,o.value.direction=-1;break;case"ArrowRight":o.value.isMovingRight=!0,o.value.direction=1;break}},C=e=>{switch(e.code){case"ArrowLeft":o.value.isMovingLeft=!1;break;case"ArrowRight":o.value.isMovingRight=!1;break}};return W(()=>{B(),window.addEventListener("keydown",x),window.addEventListener("keyup",C)}),Y(()=>{p(),window.removeEventListener("keydown",x),window.removeEventListener("keyup",C)}),{gameCanvas:t,score:h,isGameRunning:d,showGameOver:m,startGame:E,resetGame:I,handleKeyDown:x,handleKeyUp:C}}}),te={class:"game-header"},le={class:"game-title"},ie={class:"score-display"},oe={class:"game-container"},ne={class:"game-controls"},re={class:"control-panel"},se={class:"q-ml-sm"};function ue(t,a,h,d,m,f){return j(),q(Z,{class:"mario-game-page"},{default:g(()=>[n("div",te,[n("h1",le,[u(T,{name:"sports_esports",size:"md",color:"primary",class:"q-mr-sm"}),a[3]||(a[3]=U(" Mario English Adventure "))]),n("div",ie,"Score: "+G(t.score),1)]),n("div",oe,[n("canvas",{ref:"gameCanvas",onKeydown:a[0]||(a[0]=(...i)=>t.handleKeyDown&&t.handleKeyDown(...i)),onKeyup:a[1]||(a[1]=(...i)=>t.handleKeyUp&&t.handleKeyUp(...i)),tabindex:"0"},null,544)]),n("div",ne,[n("div",re,[u(A,{color:"primary",icon:"play_arrow",label:"Start Game",onClick:t.startGame,disable:t.isGameRunning},null,8,["onClick","disable"]),u(A,{color:"secondary",icon:"restart_alt",label:"Reset",onClick:t.resetGame,class:"q-ml-sm"},null,8,["onClick"])]),a[4]||(a[4]=n("div",{class:"instructions"},[n("h3",null,"How to Play:"),n("ul",null,[n("li",null,"使用方向鍵 ← → 移動瑪莉歐"),n("li",null,"使用空白鍵跳躍"),n("li",null,"頭頂對應的英文單字香菇獲得分數"),n("li",null,"撞到錯誤的香菇會失去生命值")])],-1))]),u(X,{modelValue:t.showGameOver,"onUpdate:modelValue":a[2]||(a[2]=i=>t.showGameOver=i)},{default:g(()=>[u(J,null,{default:g(()=>[u(O,{class:"row items-center"},{default:g(()=>[u(N,{icon:"sentiment_very_satisfied",color:"primary","text-color":"white"}),n("span",se,"Game Over! Final Score: "+G(t.score),1)]),_:1}),u(H,{align:"right"},{default:g(()=>[z(u(A,{flat:"",label:"Play Again",color:"primary",onClick:t.resetGame},null,8,["onClick"]),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const he=$(ae,[["render",ue],["__scopeId","data-v-a0dfe2e3"],["__file","MarioGamePage.vue"]]);export{he as default};
