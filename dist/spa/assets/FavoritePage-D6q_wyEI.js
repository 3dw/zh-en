import{Q as q,a as te,b as Q,c as se}from"./QTabPanels-ZHsQ-hLB.js";import{a3 as ue,r as d,O as ie,b as re,n as de,w as $,a4 as ce,a5 as pe,a6 as u,a7 as I,a8 as g,ac as t,a9 as n,ak as c,A as z,ag as B,aj as w,ad as v,y as ve,z as me,ah as R,an as W,am as he,al as fe,aq as Ce,aB as ge}from"./index-BBCvlH2p.js";import{Q as ye}from"./QPage-BEWgw9JM.js";import{u as ke}from"./use-quasar-FJUGCLDY.js";import{F as we}from"./FlashCard-CIea5jeL.js";import"./touch-BNesZ6GO.js";import"./rtl-DFPa-2ov.js";import"./selection-C-xGfkmI.js";const Ae=ue({name:"FavoritePage",components:{FlashCard:we},setup(e,{emit:l}){const f=ke(),i=d([]),A=d(!1),F=d([]),C=d(null),s=d(!1);ie(()=>{const o=localStorage.getItem("en_love_arr");console.log(o);function a(r){return r.map(D=>({chinese:D.chinese,english:D.english,flipped:!1}))}o&&(i.value=a(JSON.parse(o)),T()),i.value.length>=4&&(S(),E.value="multipleChoice")});const b=o=>{i.value=i.value.filter(a=>!(a.english===o.english&&a.chinese===o.chinese)),localStorage.setItem("favoriteCards",JSON.stringify(i.value))},E=d("view"),m=d(null),y=d(null),V=d(""),k=d(""),O=d(!1),p=d(0),G=re(()=>m.value?m.value.english.split(" "):[]);function X(o){o?(p.value++,f.notify({type:"positive",message:`答對了！您已連續答對${p.value}題！獲得100xp！`,position:"top",timeout:2500}),A.value=!1,s.value=!1,L()):(p.value=0,f.notify({type:"negative",message:"不太像，再試一次！",position:"top",timeout:2500}))}function T(){if(i.value.length===0){m.value=null;return}const o=Math.floor(Math.random()*i.value.length);m.value=i.value[o];const a=m.value.english.split(" ");a.length===0?y.value=null:y.value=Math.floor(Math.random()*a.length),V.value="",k.value="",O.value=!1,de(()=>{const r=document.querySelector("input");r&&r.focus()})}function H(){if(!m.value||y.value===null)return;const o=m.value.english.split(" "),a=y.value!==null&&o[y.value]||"",r=V.value.trim().toLowerCase().replace(/[.,!?;:]/g,""),D=a.trim().toLowerCase().replace(/[.,!?;:]/g,"");r===D?(p.value++,k.value="答對了！您已連續答對"+p.value+"題！",f.notify({type:"positive",message:k.value,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]}),l("earn-xp",50)):(k.value=`答錯了，正確答案是：${a}`,p.value=0,f.notify({type:"negative",message:k.value,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]})),O.value=!0;const K=ae=>{ae.key==="Enter"&&(N(),document.removeEventListener("keydown",K))};document.addEventListener("keydown",K)}function N(){T()}function Y(){const o=new SpeechSynthesisUtterance(m.value?.english);window.speechSynthesis.speak(o)}function Z(){const o=new SpeechSynthesisUtterance(M.value?.english);window.speechSynthesis.speak(o)}$(E,o=>{o==="cloze"&&T()});const h=d(null),P=d([]),U=d(null);function S(){if(i.value.length<4){h.value=null;return}const o=Math.floor(Math.random()*i.value.length);h.value=i.value[o],_()}function _(){if(!h.value)return;const o=h.value.english,a=i.value.filter(r=>r.english!==o).map(r=>r.english).sort(()=>Math.random()-.5).slice(0,3);P.value=[{label:o,value:o},...a.map(r=>({label:r,value:r}))].sort(()=>Math.random()-.5)}function x(){U.value===h.value?.english?(p.value++,f.notify({type:"positive",message:`答對了！您已連續答對${p.value}題！獲得100xp！`,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]}),l("earn-xp",100)):(p.value=0,f.notify({type:"negative",message:`答錯了，正確答案是：${h.value?.english}`,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]})),S()}function ee(){S()}$(E,o=>{o==="multipleChoice"?S():o==="speakout"&&L()});const M=d({chinese:"",english:"",flipped:!1});function L(){if(i.value.length===0){M.value=i.value[0];return}const o=Math.floor(Math.random()*i.value.length);M.value=i.value[o],j.value=""}function oe(){const o=new SpeechSynthesisUtterance(h.value?.english);window.speechSynthesis.speak(o)}$(U,o=>{if(o){const a=new SpeechSynthesisUtterance(o);window.speechSynthesis.speak(a)}});const j=d("");async function le(){try{const o=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(o);F.value=[],a.start(),A.value=!0,console.log("錄音開始"),a.ondataavailable=r=>{console.log("錄音中"),console.log(r.data),F.value.push(r.data),J()},a.onstop=()=>{A.value=!1,console.log("錄音結束")},setTimeout(()=>{a.stop(),s.value=!0},5e3)}catch(o){console.error("錄音失敗:",o)}}async function J(){const o=new Blob(F.value,{type:"audio/mp4"});new FormData().append("file",o,"recording.mp4");const r=URL.createObjectURL(o);C.value&&(C.value.src=r)}function ne(){C.value&&(C.value.src="",s.value=!1)}return{favoriteCards:i,removeFromFavorites:b,activeTab:E,currentCard:M,currentClozeCard:m,blankIndex:y,userAnswer:V,feedback:k,answered:O,correctCount:p,splitEnglishSentence:G,checkAnswer:H,nextQuestion:N,playAudio:Y,playSpeakoutAudio:Z,isRecording:A,hasRecorded:s,audioChunks:F,currentMultipleChoiceCard:h,multipleChoiceOptions:P,selectedOption:U,checkMultipleChoiceAnswer:x,nextMultipleChoiceQuestion:ee,playMultipleChoiceAudio:oe,startRecording:le,uploadAudio:J,recordedText:j,audioPlayer:C,checkAnswerSpeakoutAnswer:X,resetAudio:ne}}}),Fe={class:"q-pa-md full-width"},be={key:0,class:"text-center q-pa-lg"},Be={key:1},Ee={key:0,class:"text-center q-pa-lg"},Se={key:1},Me={class:"q-mt-md"},De={key:1,class:"text-red-7"},qe={ref:"audioPlayer",controls:""},Qe={key:2,class:"q-mt-md"},ze={key:0,class:"text-center q-pa-lg"},Re={key:1,class:"q-pa-md"},Ve={key:0},Oe={key:0,style:{color:"red"}},Te={class:"q-mt-md"},Ue={class:"q-mt-md"},$e={class:"q-mt-md"},Ie={key:0,class:"text-center q-pa-lg"},Ne={key:1,class:"q-pa-md"},Pe={key:0},Le={class:"q-mt-md"},je={class:"q-mt-md"};function Je(e,l,f,i,A,F){const C=pe("FlashCard");return u(),I(ye,{class:"flex flex-center"},{default:g(()=>[t("div",Fe,[l[15]||(l[15]=t("h2",null,"我的最愛字卡",-1)),n(te,{modelValue:e.activeTab,"onUpdate:modelValue":l[0]||(l[0]=s=>e.activeTab=s),dense:"","border-color":"primary",class:"q-mb-md"},{default:g(()=>[n(q,{name:"view",label:"卡片"}),n(q,{name:"cloze",label:"克漏字"}),n(q,{name:"multipleChoice",label:"四選一"}),n(q,{name:"speakout",label:"開口說"})]),_:1},8,["modelValue"]),n(se,{modelValue:e.activeTab,"onUpdate:modelValue":l[7]||(l[7]=s=>e.activeTab=s),animated:""},{default:g(()=>[n(Q,{name:"view"},{default:g(()=>[e.favoriteCards.length===0?(u(),c("div",be,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[8]||(l[8]=t("p",{class:"text-grey-7"},"還沒有收藏的字卡",-1)),l[9]||(l[9]=t("p",{class:"text-grey-7"},"在學習時點擊愛心圖示來收藏字卡",-1))])):(u(),c("div",Be,[n(C,{sentences:e.favoriteCards,onEarnXp:l[1]||(l[1]=s=>e.$emit("earn-xp",s))},null,8,["sentences"])]))]),_:1}),n(Q,{name:"speakout"},{default:g(()=>[e.favoriteCards.length===0?(u(),c("div",Ee,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[10]||(l[10]=t("p",{class:"text-grey-7"},"還沒有收藏的字卡",-1))])):(u(),c("div",Se,[t("div",Me,[t("h2",null,[B(" 中文："+w(e.currentCard.chinese)+" ",1),l[11]||(l[11]=t("br",null,null,-1)),B(" 英文："+w(e.currentCard.english)+" ",1),n(v,{icon:"volume_up",size:"lg",color:"primary",onClick:e.playSpeakoutAudio,flat:""},null,8,["onClick"])]),e.isRecording?(u(),c("span",De,"錄音中...")):(u(),I(v,{key:0,icon:"mic",size:"lg",color:"primary",onClick:e.startRecording,flat:""},null,8,["onClick"])),ve(t("audio",qe,null,512),[[me,!e.isRecording&&e.hasRecorded]]),!e.isRecording&&e.hasRecorded?(u(),c("div",Qe,[n(v,{color:"primary",label:"很棒！下一題",onClick:l[2]||(l[2]=s=>e.checkAnswerSpeakoutAnswer(!0))}),n(v,{color:"secondary",label:"再試一次",onClick:l[3]||(l[3]=s=>e.checkAnswerSpeakoutAnswer(!1))}),!e.isRecording&&e.hasRecorded?(u(),I(v,{key:0,color:"primary",label:"清空音檔",onClick:e.resetAudio},null,8,["onClick"])):R("",!0)])):R("",!0)])]))]),_:1}),n(Q,{name:"cloze"},{default:g(()=>[e.favoriteCards.length===0?(u(),c("div",ze,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[12]||(l[12]=t("p",{class:"text-grey-7"},"還沒有收藏的字卡，無法進行克漏字練習",-1))])):(u(),c("div",Re,[e.currentClozeCard?(u(),c("div",Ve,[t("h2",null,[B(" 中文："+w(e.currentClozeCard.chinese)+" ",1),n(v,{icon:"volume_up",size:"lg",color:"primary",onClick:e.playAudio,flat:""},null,8,["onClick"])]),l[13]||(l[13]=t("h2",null,"英文：",-1)),t("p",null,[(u(!0),c(W,null,he(e.splitEnglishSentence,(s,b)=>(u(),c("span",{key:b},[b===e.blankIndex?(u(),c("span",Oe,"_______")):(u(),c(W,{key:1},[B(w(s),1)],64)),B(" "+w(b<e.splitEnglishSentence.length-1?" ":""),1)]))),128))]),t("div",Te,[n(fe,{autofocus:!0,modelValue:e.userAnswer,"onUpdate:modelValue":l[4]||(l[4]=s=>e.userAnswer=s),label:"請填入缺少的單字",disable:e.answered,onKeydown:l[5]||(l[5]=Ce(s=>!e.answered&&e.userAnswer&&e.checkAnswer(),["enter"])),class:"large-input"},null,8,["modelValue","disable"])]),t("div",Ue,[n(v,{color:"primary",label:"檢查答案",onClick:e.checkAnswer,disable:e.answered||!e.userAnswer},null,8,["onClick","disable"])]),t("div",$e,[n(v,{color:"secondary",label:"下一題",onClick:e.nextQuestion},null,8,["onClick"])])])):R("",!0)]))]),_:1}),n(Q,{name:"multipleChoice"},{default:g(()=>[e.favoriteCards.length<4?(u(),c("div",Ie,[n(z,{name:"favorite_border",size:"50px",color:"grey-5"}),l[14]||(l[14]=t("p",{class:"text-grey-7"},"收藏的字卡不足以進行四選一測驗，請收藏更多字卡",-1))])):(u(),c("div",Ne,[e.currentMultipleChoiceCard?(u(),c("div",Pe,[t("h2",null," 中文："+w(e.currentMultipleChoiceCard.chinese),1),n(ge,{modelValue:e.selectedOption,"onUpdate:modelValue":l[6]||(l[6]=s=>e.selectedOption=s),options:e.multipleChoiceOptions,type:"radio"},null,8,["modelValue","options"]),t("div",Le,[n(v,{color:"primary",label:"檢查答案",onClick:e.checkMultipleChoiceAnswer,disable:!e.selectedOption},null,8,["onClick","disable"])]),t("div",je,[n(v,{color:"secondary",label:"下一題",onClick:e.nextMultipleChoiceQuestion},null,8,["onClick"])])])):R("",!0)]))]),_:1})]),_:1},8,["modelValue"])])]),_:1})}const xe=ce(Ae,[["render",Je],["__scopeId","data-v-5418bdf0"],["__file","FavoritePage.vue"]]);export{xe as default};
