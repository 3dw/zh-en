import{X as ue,r as d,H as re,bb as ie,b as de,n as ce,w as P,_ as pe,Y as j,Z as a,$ as B,a0 as g,a4 as s,ab as r,a1 as u,a5 as m,a9 as p,aa as R,a8 as q,ad as w,I as ve,ax as me,ae as G,ac as he,ag as fe,ak as Ce,aw as ge}from"./index-vbdb1ibV.js";import{Q as ye,a as V,b as ke,c as $}from"./QTabPanels-Ch-hwz2R.js";import{Q as we}from"./QPage-CrcP3Lnz.js";import{u as Fe}from"./use-quasar-Djv61dMn.js";import{F as be}from"./FlashCard-XvpoI14r.js";import{a as Ae}from"./axios-CmsuhreG.js";import"./QResizeObserver-CXt7Uu1s.js";import"./rtl-DFPa-2ov.js";import"./use-panel-BmNvLIz8.js";import"./touch-BjYP5sR0.js";import"./selection-B7wQqxD5.js";const Be=ue({name:"FavoritePage",components:{FlashCard:be},setup(e,{emit:t}){const y=Fe(),i=d([]),E=d(!1),S=d([]),k=d(null),F=d(!1);re(()=>{const o=localStorage.getItem("en_love_arr");console.log(o);function l(f){return f.map(M=>({chinese:M.chinese,english:M.english,flipped:!1}))}o&&(i.value=l(JSON.parse(o)),O()),i.value.length>=4&&(z(),D.value="multipleChoice");const n=ie();n.params.activeTab&&(D.value=n.params.activeTab)});function c(o,l){const n=o.replace(/[.,!?;:]/g,"").replace(/\s/g,""),f=l.replace(/[.,!?;:]/g,"").replace(/\s/g,"");return n.toLowerCase()===f.toLowerCase()}const T=o=>{i.value=i.value.filter(l=>!(l.english===o.english&&l.chinese===o.chinese)),localStorage.setItem("favoriteCards",JSON.stringify(i.value))},D=d("view"),h=d(null),b=d(null),U=d(""),A=d(""),I=d(!1),v=d(0),H=de(()=>h.value?h.value.english.split(" "):[]);function Y(o){o?(v.value++,y.notify({type:"positive",message:`答對了！您已連續答對${v.value}題！獲得100xp！`,position:"top",timeout:2500}),E.value=!1,F.value=!1,W()):(v.value=0,y.notify({type:"negative",message:"不太像，再試一次！請再按一次錄音按鈕",position:"top",timeout:2500}))}function O(){if(i.value.length===0){h.value=null;return}const o=Math.floor(Math.random()*i.value.length);h.value=i.value[o];const l=h.value.english.split(" ");l.length===0?b.value=null:b.value=Math.floor(Math.random()*l.length),U.value="",A.value="",I.value=!1,ce(()=>{const n=document.querySelector("input");n&&n.focus()})}function Z(){if(!h.value||b.value===null)return;const o=h.value.english.split(" "),l=b.value!==null&&o[b.value]||"",n=U.value.trim().toLowerCase().replace(/[.,!?;:]/g,""),f=l.trim().toLowerCase().replace(/[.,!?;:]/g,"");n===f?(v.value++,A.value="答對了！您已連續答對"+v.value+"題！",y.notify({type:"positive",message:A.value,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]}),t("earn-xp",50)):(A.value=`答錯了，正確答案是：${l}`,v.value=0,y.notify({type:"negative",message:A.value,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]})),I.value=!0;const M=se=>{se.key==="Enter"&&(J(),document.removeEventListener("keydown",M))};document.addEventListener("keydown",M)}function J(){O()}function _(){const o=new SpeechSynthesisUtterance(h.value?.english);window.speechSynthesis.speak(o)}function x(){const o=new SpeechSynthesisUtterance(Q.value?.english);window.speechSynthesis.speak(o)}P(D,o=>{o==="cloze"&&O()});const C=d(null),K=d([]),L=d(null);function z(){if(i.value.length<4){C.value=null;return}const o=Math.floor(Math.random()*i.value.length);C.value=i.value[o],ee()}function ee(){if(!C.value)return;const o=C.value.english,l=i.value.filter(n=>n.english!==o).map(n=>n.english).sort(()=>Math.random()-.5).slice(0,3);K.value=[{label:o,value:o},...l.map(n=>({label:n,value:n}))].sort(()=>Math.random()-.5)}function oe(){L.value===C.value?.english?(v.value++,y.notify({type:"positive",message:`答對了！您已連續答對${v.value}題！獲得100xp！`,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]}),t("earn-xp",100)):(v.value=0,y.notify({type:"negative",message:`答錯了，正確答案是：${C.value?.english}`,position:"top",timeout:2500,actions:[{icon:"close",color:"white"}]})),z()}function te(){z()}P(D,o=>{o==="multipleChoice"?z():o==="speakout"&&W()});const Q=d({chinese:"",english:"",flipped:!1});function W(){if(i.value.length===0){Q.value=i.value[0];return}const o=Math.floor(Math.random()*i.value.length);Q.value=i.value[o],N.value=""}function ae(){const o=new SpeechSynthesisUtterance(C.value?.english);window.speechSynthesis.speak(o)}P(L,o=>{if(o){const l=new SpeechSynthesisUtterance(o);window.speechSynthesis.speak(l)}});const N=d("");async function le(){try{const o=await navigator.mediaDevices.getUserMedia({audio:!0}),l=new MediaRecorder(o);S.value=[],l.start(),E.value=!0,console.log("錄音開始"),l.ondataavailable=n=>{console.log("錄音中"),console.log(n.data),S.value.push(n.data),X()},l.onstop=()=>{E.value=!1,console.log("錄音結束"),o.getTracks().forEach(n=>n.stop())},setTimeout(()=>{l.stop(),F.value=!0},5e3)}catch(o){console.error("錄音失敗:",o)}}async function X(){const o=new Blob(S.value,{type:"audio/mp4"}),l=new FormData;l.append("file",o,"recording.mp4");const n=URL.createObjectURL(o);k.value&&(k.value.src=n);const f=await Ae.post("https://zh-en-backend.alearn13994229.workers.dev/convert-speech-to-text",l,{headers:{"Content-Type":"multipart/form-data"}});console.log(f.data),console.log(f.data.text),N.value=f.data.text}function ne(){k.value&&(k.value.src="",F.value=!1)}return{favoriteCards:i,removeFromFavorites:T,activeTab:D,currentCard:Q,currentClozeCard:h,blankIndex:b,userAnswer:U,feedback:A,answered:I,correctCount:v,splitEnglishSentence:H,checkAnswer:Z,nextQuestion:J,playAudio:_,playSpeakoutAudio:x,isSimilar:c,isRecording:E,hasRecorded:F,audioChunks:S,currentMultipleChoiceCard:C,multipleChoiceOptions:K,selectedOption:L,checkMultipleChoiceAnswer:oe,nextMultipleChoiceQuestion:te,playMultipleChoiceAudio:ae,startRecording:le,uploadAudio:X,recordedText:N,audioPlayer:k,checkAnswerSpeakoutAnswer:Y,resetAudio:ne}}}),Ee={class:"q-pa-md full-width"},Se={key:0},Te={class:"text-center q-pa-lg"},De={key:0,class:"text-center q-pa-lg"},Me={key:1},qe={key:0,class:"text-center q-pa-lg"},ze={key:1},Qe={class:"q-mt-md"},Re={key:1,class:"text-red-7"},Ve={ref:"audioPlayer",controls:""},$e={key:2},Ue={key:3},Ie={key:4},Oe={key:5,class:"q-mt-md"},Le={key:0,class:"text-center q-pa-lg"},Ne={key:1,class:"q-pa-md"},Pe={key:0},Je={key:0,style:{color:"red"}},Ke={class:"q-mt-md"},We={class:"q-mt-md"},Xe={class:"q-mt-md"},je={key:0,class:"text-center q-pa-lg"},Ge={key:1,class:"q-pa-md"},He={key:0},Ye={class:"q-mt-md"},Ze={class:"q-mt-md"};function _e(e,t,y,i,E,S){const k=j("router-link"),F=j("FlashCard");return a(),B(we,{class:"flex flex-center"},{default:g(()=>[s("div",Ee,[t[17]||(t[17]=s("h2",null,"我的最愛字卡",-1)),e.favoriteCards.length===0?(a(),r("div",Se,[s("div",Te,[t[8]||(t[8]=s("p",{class:"text-grey-7"},"還沒有收藏的字卡",-1)),t[9]||(t[9]=s("p",{class:"text-grey-7"},"在學習時點擊愛心圖示來收藏字卡",-1)),u(k,{to:"/beginner"},{default:g(()=>[u(m,{size:"lg",color:"primary",label:"收集字卡"})]),_:1})])])):p("",!0),e.favoriteCards.length>0?(a(),B(ye,{key:1,modelValue:e.activeTab,"onUpdate:modelValue":t[0]||(t[0]=c=>e.activeTab=c),dense:"","border-color":"primary",class:"q-mb-md"},{default:g(()=>[u(V,{name:"view",label:"卡片"}),u(V,{name:"cloze",label:"克漏字"}),u(V,{name:"multipleChoice",label:"四選一"}),u(V,{name:"speakout",label:"開口說"})]),_:1},8,["modelValue"])):p("",!0),e.favoriteCards.length>0?(a(),B(ke,{key:2,modelValue:e.activeTab,"onUpdate:modelValue":t[7]||(t[7]=c=>e.activeTab=c),animated:""},{default:g(()=>[u($,{name:"view"},{default:g(()=>[e.favoriteCards.length===0?(a(),r("div",De,[u(R,{name:"favorite_border",size:"50px",color:"grey-5"}),t[10]||(t[10]=s("p",{class:"text-grey-7"},"還沒有收藏的字卡",-1)),t[11]||(t[11]=s("p",{class:"text-grey-7"},"在學習時點擊愛心圖示來收藏字卡",-1))])):(a(),r("div",Me,[u(F,{sentences:e.favoriteCards,onEarnXp:t[1]||(t[1]=c=>e.$emit("earn-xp",c))},null,8,["sentences"])]))]),_:1}),u($,{name:"speakout"},{default:g(()=>[e.favoriteCards.length===0?(a(),r("div",qe,[u(R,{name:"favorite_border",size:"50px",color:"grey-5"}),t[12]||(t[12]=s("p",{class:"text-grey-7"},"還沒有收藏的字卡",-1))])):(a(),r("div",ze,[s("div",Qe,[s("h2",null,[q(" 中文："+w(e.currentCard.chinese)+" ",1),t[13]||(t[13]=s("br",null,null,-1)),q(" 英文："+w(e.currentCard.english)+" ",1),u(m,{icon:"volume_up",size:"lg",color:"primary",onClick:e.playSpeakoutAudio,flat:""},null,8,["onClick"])]),e.isRecording?(a(),r("span",Re,"錄音中...")):(a(),B(m,{key:0,icon:"mic",size:"lg",color:"primary",onClick:e.startRecording,flat:""},null,8,["onClick"])),ve(s("audio",Ve,null,512),[[me,!e.isRecording&&e.hasRecorded]]),e.recordedText?(a(),r("p",$e,"AI分析錄音結果："+w(e.recordedText),1)):p("",!0),e.recordedText&&e.isSimilar(e.recordedText,e.currentCard.english)?(a(),r("p",Ue,"答對了！")):p("",!0),e.recordedText&&!e.isSimilar(e.recordedText,e.currentCard.english)?(a(),r("p",Ie," 有點不像... ")):p("",!0),!e.isRecording&&e.hasRecorded&&e.recordedText?(a(),r("div",Oe,[e.recordedText&&e.isSimilar(e.recordedText,e.currentCard.english)?(a(),B(m,{key:0,color:"primary",label:"很棒！下一題",onClick:t[2]||(t[2]=c=>e.checkAnswerSpeakoutAnswer(!0))})):p("",!0),e.recordedText&&!e.isSimilar(e.recordedText,e.currentCard.english)?(a(),B(m,{key:1,color:"secondary",label:"再試一次",onClick:t[3]||(t[3]=c=>e.checkAnswerSpeakoutAnswer(!1))})):p("",!0)])):p("",!0)])]))]),_:1}),u($,{name:"cloze"},{default:g(()=>[e.favoriteCards.length===0?(a(),r("div",Le,[u(R,{name:"favorite_border",size:"50px",color:"grey-5"}),t[14]||(t[14]=s("p",{class:"text-grey-7"},"還沒有收藏的字卡，無法進行克漏字練習",-1))])):(a(),r("div",Ne,[e.currentClozeCard?(a(),r("div",Pe,[s("h2",null,[q(" 中文："+w(e.currentClozeCard.chinese)+" ",1),u(m,{icon:"volume_up",size:"lg",color:"primary",onClick:e.playAudio,flat:""},null,8,["onClick"])]),t[15]||(t[15]=s("h2",null,"英文：",-1)),s("p",null,[(a(!0),r(G,null,he(e.splitEnglishSentence,(c,T)=>(a(),r("span",{key:T},[T===e.blankIndex?(a(),r("span",Je,"_______")):(a(),r(G,{key:1},[q(w(c),1)],64)),q(" "+w(T<e.splitEnglishSentence.length-1?" ":""),1)]))),128))]),s("div",Ke,[u(fe,{autofocus:!0,modelValue:e.userAnswer,"onUpdate:modelValue":t[4]||(t[4]=c=>e.userAnswer=c),label:"請填入缺少的單字",disable:e.answered,onKeydown:t[5]||(t[5]=Ce(c=>!e.answered&&e.userAnswer&&e.checkAnswer(),["enter"])),class:"large-input"},null,8,["modelValue","disable"])]),s("div",We,[u(m,{color:"primary",label:"檢查答案",onClick:e.checkAnswer,disable:e.answered||!e.userAnswer},null,8,["onClick","disable"])]),s("div",Xe,[u(m,{color:"secondary",label:"下一題",onClick:e.nextQuestion},null,8,["onClick"])])])):p("",!0)]))]),_:1}),u($,{name:"multipleChoice"},{default:g(()=>[e.favoriteCards.length<4?(a(),r("div",je,[u(R,{name:"favorite_border",size:"50px",color:"grey-5"}),t[16]||(t[16]=s("p",{class:"text-grey-7"},"收藏的字卡不足以進行四選一測驗，請收藏更多字卡",-1))])):(a(),r("div",Ge,[e.currentMultipleChoiceCard?(a(),r("div",He,[s("h2",null," 中文："+w(e.currentMultipleChoiceCard.chinese),1),u(ge,{modelValue:e.selectedOption,"onUpdate:modelValue":t[6]||(t[6]=c=>e.selectedOption=c),options:e.multipleChoiceOptions,type:"radio"},null,8,["modelValue","options"]),s("div",Ye,[u(m,{color:"primary",label:"檢查答案",onClick:e.checkMultipleChoiceAnswer,disable:!e.selectedOption},null,8,["onClick","disable"])]),s("div",Ze,[u(m,{color:"secondary",label:"下一題",onClick:e.nextMultipleChoiceQuestion},null,8,["onClick"])])])):p("",!0)]))]),_:1})]),_:1},8,["modelValue"])):p("",!0)])]),_:1})}const co=pe(Be,[["render",_e],["__scopeId","data-v-e3a5d73b"],["__file","FavoritePage.vue"]]);export{co as default};
