import{a3 as I,r as d,a0 as A,a4 as L,a6 as h,a7 as R,a8 as s,ac as r,a9 as o,A as E,ag as v,b6 as z,al as G,bf as U,bg as F,aj as p,ad as k,aa as V,ak as w,an as J,am as M,ah as O,ab as H,af as K}from"./index-u7gP2akL.js";import{Q as j,b as q,a as C}from"./QItem-CuGU25sW.js";import{a as W,Q as $}from"./QForm-DnxsLT0L.js";import{Q as X}from"./QImg-9MbXX85t.js";import{Q as Y}from"./QLinearProgress-CtlBuMuC.js";import{Q as Z}from"./QPage-CLiibsKN.js";import{u as x}from"./use-quasar-96ZBGOZf.js";import"./QChip-POqwdYFt.js";import"./position-engine-C3CkXWYS.js";import"./selection-BDEOF8pu.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const ee=I({name:"StoryPageBackend",emits:["closeLeftDrawer"],setup(a,{emit:t}){const m=x(),B=d(!1),g=A({childName:"",ageGroup:"",storyType:""}),S=d(!1),e=d("正在生成故事..."),l=d(null),y=d([]),D=d([]),c=d([]),P=d(null),N=d(null);return{formData:g,loading:B,showProgress:S,progressMessage:e,generatedStory:l,storyParagraphs:y,paragraphImages:D,translatedParagraphs:c,audioPlayer:P,storySection:N,printStory:()=>{console.log("列印故事"),l.value?(t("closeLeftDrawer"),setTimeout(()=>{window.print()},1e3)):m.notify({type:"negative",message:"故事尚未生成"})},generateStory:async()=>{try{B.value=!0,S.value=!0,y.value=[],D.value=[],c.value=[],l.value=null,e.value="正在創作故事...";const n=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({childName:g.childName,ageGroup:g.ageGroup,storyType:g.storyType,step:1})});if(!n.ok)throw new Error("故事生成失敗");const f=await n.json();if(!f.success)throw new Error(f.error||"故事生成失敗");y.value=f.content.split(`

`).filter(i=>i.trim());for(let i=0;i<y.value.length;i++){e.value=`正在翻譯...${i+1}/${y.value.length}`;const T=y.value[i],Q=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:T})})).text();c.value.push(Q)}for(let i=0;i<c.value.length;i++){const T=c.value[i];e.value=`正在生成配圖...${i+1}/${c.value.length}`;const _=await fetch("https://zh-en-backend.alearn13994229.workers.dev/generate-image-by-single-paragraph",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyParagraph:T})});if(!_.ok)throw new Error("圖片生成失敗");const Q=await _.json();D.value.push(Q.image)}e.value="正在生成語音...";const b=await fetch("https://zh-en-backend.alearn13994229.workers.dev/StoryGeneration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({step:3,content:c.value.join()})});if(!b.ok)throw new Error("語音生成失敗");const u=await b.json();if(!u.success)throw new Error(u.error||"語音生成失敗");l.value={content:f.content,audioUrl:u.audioUrl},setTimeout(()=>{P.value&&P.value.play(),N.value?.scrollIntoView({behavior:"smooth",block:"start"})},1e3),m.notify({type:"positive",message:"故事生成完成！",position:"top"})}catch(n){m.notify({type:"negative",message:`發生錯誤：${n instanceof Error?n.message:"請稍後重試"}`,position:"top"}),console.error("生成故事時發生錯誤：",n)}finally{B.value=!1,S.value=!1}},audioEnded:()=>{console.log("音頻播放結束")},downloadAudio:async()=>{try{if(!l.value?.audioUrl)throw new Error("找不到音頻檔案");const f=await(await fetch(l.value.audioUrl)).blob(),b=window.URL.createObjectURL(f),u=document.createElement("a");u.href=b,u.download=`${g.childName}的故事.mp3`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(b),document.body.removeChild(u),m.notify({type:"positive",message:"音頻檔案下載成功！",position:"top"})}catch(n){m.notify({type:"negative",message:`下載失敗：${n instanceof Error?n.message:"請稍後重試"}`,position:"top"}),console.error("下載音頻時發生錯誤：",n)}},ageOptions:[{label:"2-4歲 (學前)",value:"2-4",description:"簡單有趣的故事，適合幼兒園前的寶寶"},{label:"5-7歲 (幼兒園)",value:"5-7",description:"包含基礎生活詞彙的故事"},{label:"8-10歲 (小學)",value:"8-10",description:"較長的故事，豐富的詞彙和情節"},{label:"10+歲 (小學高年級以上)",value:"10+",description:"更長的故事，更豐富的詞彙和情節"}],storyTypeOptions:[{label:"冒險故事",value:"adventure",description:"充滿刺激和挑戰的冒險故事"},{label:"童話故事",value:"fairy_tale",description:"充滿魔法和想像力的奇幻故事"},{label:"教育故事",value:"educational",description:"包含生活教育意義的啟發性故事"},{label:"動物故事",value:"animal",description:"以可愛動物為主角的溫馨故事"},{label:"科幻故事",value:"sci_fi",description:"激發想像力的科學幻想故事"}]}}}),ae={class:"story-container"},oe={class:"hero-title"},te={class:"content-wrapper"},se={class:"form-wrapper"},re={class:"input-group"},le={class:"input-group"},ne={class:"input-group"},ie={class:"row justify-center q-mt-lg"},ue={key:0,ref:"storySection",class:"story-section q-mt-xl"},de={class:"story-title q-mb-lg"},pe={class:"story-content col-12 col-md-7"},ce={class:"text-body1"},me={class:"text-body1"},ge={key:0,class:"story-image col-12 col-md-5"},ye={key:0,class:"audio-player"},fe=["src"],he={class:"row justify-end q-mt-md"},ve={class:"q-ml-sm"};function be(a,t,m,B,g,S){return h(),R(Z,{class:"story-page-backend"},{default:s(()=>[r("div",ae,[r("h2",oe,[o(E,{name:"auto_stories",size:"md",color:"primary",class:"q-mr-sm"}),t[5]||(t[5]=v(" Create ")),t[6]||(t[6]=r("span",{class:"highlight"},"Bedtime Stories",-1)),t[7]||(t[7]=r("div",{class:"subtitle"},"創造獨特的英文睡前故事",-1))]),r("div",te,[r("div",se,[o(V,{class:"form-card q-pa-xl"},{default:s(()=>[o(W,{onSubmit:z(a.generateStory,["prevent"]),class:"q-gutter-md"},{default:s(()=>[r("div",re,[o(G,{modelValue:a.formData.childName,"onUpdate:modelValue":t[0]||(t[0]=e=>a.formData.childName=e),outlined:"",label:"孩子的名字",rules:[e=>!!e||"請輸入名字",e=>e.length<=20||"名字不能超過20個字符"]},{prepend:s(()=>[o(E,{name:"person"})]),hint:s(()=>t[8]||(t[8]=[v(" 可以輸入中文或英文名字 ")])),_:1},8,["modelValue","rules"])]),r("div",le,[o($,{modelValue:a.formData.ageGroup,"onUpdate:modelValue":t[1]||(t[1]=e=>a.formData.ageGroup=e),options:a.ageOptions,outlined:"",label:"年齡段","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇年齡段"]},{prepend:s(()=>[o(E,{name:"child_care"})]),option:s(e=>[o(j,U(F(e.itemProps)),{default:s(()=>[o(q,null,{default:s(()=>[o(C,null,{default:s(()=>[v(p(e.opt.label),1)]),_:2},1024),o(C,{caption:""},{default:s(()=>[v(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",ne,[o($,{modelValue:a.formData.storyType,"onUpdate:modelValue":t[2]||(t[2]=e=>a.formData.storyType=e),options:a.storyTypeOptions,outlined:"",label:"故事類型","emit-value":"","map-options":"",rules:[e=>!!e||"請選擇故事類型"]},{prepend:s(()=>[o(E,{name:"auto_stories"})]),option:s(e=>[o(j,U(F(e.itemProps)),{default:s(()=>[o(q,null,{default:s(()=>[o(C,null,{default:s(()=>[v(p(e.opt.label),1)]),_:2},1024),o(C,{caption:""},{default:s(()=>[v(p(e.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])]),r("div",ie,[o(k,{type:"submit",color:"primary",label:"開始創建故事",loading:a.loading,class:"submit-btn"},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),t[9]||(t[9]=r("div",{class:"tiger-image"},[r("img",{src:"/images/tiger.png",alt:"Storyteller Tiger"})],-1))])]),a.generatedStory?(h(),w("div",ue,[o(V,{class:"story-card q-pa-lg"},{default:s(()=>[r("h3",de,p(a.formData.childName)+" 的故事",1),(h(!0),w(J,null,M(a.storyParagraphs,(e,l)=>(h(),w("div",{key:l,class:"paragraph-section q-mb-xl row items-start q-col-gutter-lg"},[r("div",pe,[r("p",ce,p(a.translatedParagraphs[l]),1),r("p",me,p(e),1)]),a.paragraphImages[l]?(h(),w("div",ge,[o(X,{src:a.paragraphImages[l],"spinner-color":"primary",style:{"border-radius":"12px","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},null,8,["src"])])):O("",!0)]))),128)),a.generatedStory.audioUrl?(h(),w("div",ye,[r("audio",{ref:"audioPlayer",src:a.generatedStory.audioUrl,controls:"",class:"full-width",onEnded:t[3]||(t[3]=(...e)=>a.audioEnded&&a.audioEnded(...e))},null,40,fe)])):O("",!0),r("div",he,[o(k,{flat:"",color:"primary",label:"下載語音",disable:a.loading||!a.generatedStory?.audioUrl,onClick:a.downloadAudio,icon:"download"},null,8,["disable","onClick"]),o(k,{flat:"",color:"primary",label:"列印故事",disable:a.loading,onClick:a.printStory,icon:"print"},null,8,["disable","onClick"]),o(k,{flat:"",color:"primary",label:"重新生成",disable:a.loading,onClick:a.generateStory,icon:"refresh"},null,8,["disable","onClick"])])]),_:1})],512)):O("",!0),o(K,{modelValue:a.showProgress,"onUpdate:modelValue":t[4]||(t[4]=e=>a.showProgress=e),persistent:""},{default:s(()=>[o(V,{style:{"min-width":"300px"}},{default:s(()=>[o(H,{class:"row items-center"},{default:s(()=>[r("span",ve,p(a.progressMessage),1),o(Y,{indeterminate:"",class:"q-mt-md",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const $e=L(ee,[["render",be],["__file","StoryPage_backend.vue"]]);export{$e as default};
