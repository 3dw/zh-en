import{a as A,Q as R,c as D,b as H}from"./QTabPanels-D2mqOTWI.js";import{X as M,r as i,H as W,w as X,_ as Y,Y as G,Z as v,$,a0 as o,a4 as d,a1 as l,ah as N,I as w,ax as q,a5 as p,ab as T,aa as K,ac as x,a8 as E,ad as O,ae as _,a2 as ee,a3 as P,aq as ae,a7 as se}from"./index-CvPFqmQk.js";import{Q as le}from"./QForm-rFNBeU8X.js";import{Q as J}from"./QItemLabel-6g870iWO.js";import{Q as te,a as Z}from"./QItem-Cn8LUp-_.js";import{Q as oe}from"./QList-MBdgJZL2.js";import{Q as ne}from"./QPage-CA5lyVHS.js";import{C as z}from"./ClosePopup-DAmM3T4A.js";import{F as ue}from"./FlashCard-DBlWHs7u.js";import{g as re,o as ie}from"./index-ea1a36e4-yErB6TnM.js";import"./index.esm2017-ClwH-SB1.js";import{g as de,r as j,a as ce,s as k}from"./index.esm2017-CFsHUG3Y.js";import"./QResizeObserver-Q4DNTxrK.js";import"./rtl-DFPa-2ov.js";import"./use-panel-CLY2LXeb.js";import"./touch-BjYP5sR0.js";import"./selection-B5XIplfg.js";const me=M({name:"CustomCardsPage",components:{FlashCard:ue},setup(){const s=i("create"),e=i([]),c=i([]),n=i({english:"",chinese:"",flipped:!1}),y=i(!1),f=i(-1),h=re(),t=de(),m=i(h.currentUser),b=i(!1),L=i(!1);W(()=>{b.value=!0,ie(h,async a=>{m.value=a,a?(console.log("user",a),console.log("user.uid",a.uid),await Q(a.uid)):S(),b.value=!1})}),X(m,async a=>{a?(console.log("newUser",a),console.log("newUser.uid",a.uid),await Q(a.uid)):S()});const S=()=>{const a=localStorage.getItem("customCards");a&&(e.value=JSON.parse(a),c.value=Array(e.value.length).fill(!1))},Q=async a=>{console.log("syncUserData",a);try{const u=localStorage.getItem("customCards"),r=u?JSON.parse(u):[],B=j(t,`users/${a}/customCards`),I=await ce(B),g=I.exists()?I.val():[];if(r.length>0&&g.length===0)await k(B,r),e.value=r;else if(r.length===0&&g.length>0)localStorage.setItem("customCards",JSON.stringify(g)),e.value=g;else if(r.length>0&&g.length>0){const C=[...g];for(const F of r)C.some(U=>U.english===F.english&&U.chinese===F.chinese)||C.push(F);await k(B,C),localStorage.setItem("customCards",JSON.stringify(C)),e.value=C}c.value=Array(e.value.length).fill(!1)}catch(u){console.error("同步用戶資料失敗:",u)}},V=async()=>{if(localStorage.setItem("customCards",JSON.stringify(e.value)),m.value)try{const a=j(t,`users/${m.value.uid}/customCards`);await k(a,e.value)}catch(a){console.error("保存到 Firebase 失敗:",a)}};return{activeTab:s,customCards:e,flippedCards:c,newCard:n,showDeleteDialog:y,currentUser:m,isLoading:b,synced:L,createCard:()=>{!n.value.english||!n.value.chinese||(e.value.push({english:n.value.english,chinese:n.value.chinese,flipped:!1}),c.value.push(!1),V(),n.value={english:"",chinese:"",flipped:!1},s.value="view")},flipCard:a=>{c.value[a]=!c.value[a]},confirmDelete:a=>{f.value=a,y.value=!0},deleteCard:()=>{f.value!==-1&&(e.value.splice(f.value,1),c.value.splice(f.value,1),V())},speakText:(a,u="en-US")=>{if(a){const r=new SpeechSynthesisUtterance(a);r.lang=u,r.rate=.8,window.speechSynthesis.speak(r)}},autoTranslateZhToEn:async()=>{try{const u=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n.value.chinese})})).json();console.log(u),n.value.english=u||"",console.log("newCard.value.english",n.value.english)}catch(a){console.error("翻譯失敗:",a)}},autoTranslateEnToZh:async()=>{try{const u=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-en-to-zh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n.value.english})})).json();console.log(u),n.value.chinese=u||"",console.log("newCard.value.chinese",n.value.chinese)}catch(a){console.error("翻譯失敗:",a)}}}}}),pe={class:"word-card-list"},ge={class:"row justify-between q-mt-lg"},fe={key:0,class:"text-center q-pa-lg"},Ce={key:1};function ve(s,e,c,n,y,f){const h=G("FlashCard");return v(),$(ne,{class:"q-pa-md"},{default:o(()=>[d("div",pe,[e[12]||(e[12]=d("h1",{class:"page-title"},"自訂字卡",-1)),l(R,{modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=t=>s.activeTab=t),class:"text-primary q-mb-lg"},{default:o(()=>[l(A,{name:"create",label:"新增字卡",icon:"add_circle"}),l(A,{name:"view",label:"我的字卡",icon:"list"}),l(A,{name:"manage",label:"管理字卡",icon:"settings"})]),_:1},8,["modelValue"]),l(H,{modelValue:s.activeTab,"onUpdate:modelValue":e[5]||(e[5]=t=>s.activeTab=t),animated:""},{default:o(()=>[l(D,{name:"create"},{default:o(()=>[e[7]||(e[7]=d("div",{class:"text-h6 q-mb-md"},"新增自訂字卡",-1)),l(le,{onSubmit:s.createCard,class:"q-gutter-md"},{default:o(()=>[l(N,{modelValue:s.newCard.english,"onUpdate:modelValue":e[1]||(e[1]=t=>s.newCard.english=t),label:"英文單字或句子",rules:[t=>!!t||"請輸入英文內容"],outlined:"",class:"large-input",type:"textarea"},null,8,["modelValue","rules"]),l(N,{modelValue:s.newCard.chinese,"onUpdate:modelValue":e[2]||(e[2]=t=>s.newCard.chinese=t),label:"中文翻譯",rules:[t=>!!t||"請輸入中文翻譯"],outlined:"",class:"large-input",type:"textarea"},null,8,["modelValue","rules"]),w(l(p,{class:"little-margin",icon:"language",label:"自動英翻中",color:"primary",onClick:s.autoTranslateEnToZh},null,8,["onClick"]),[[q,s.newCard.english&&!s.newCard.chinese]]),w(l(p,{class:"little-margin",icon:"language",label:"自動中翻英",color:"primary",onClick:s.autoTranslateZhToEn},null,8,["onClick"]),[[q,s.newCard.chinese&&!s.newCard.english]]),d("div",ge,[l(p,{class:"little-margin",icon:"volume_up",color:"secondary",label:"英文發音測試",onClick:e[3]||(e[3]=t=>s.speakText(s.newCard.english,"en-US")),disable:!s.newCard.english},null,8,["disable"]),l(p,{class:"little-margin",icon:"volume_up",color:"green-8",label:"中文發音測試",onClick:e[4]||(e[4]=t=>s.speakText(s.newCard.chinese,"zh-TW")),disable:!s.newCard.chinese},null,8,["disable"]),l(p,{class:"little-margin",type:"submit",color:"primary",label:"新增字卡",icon:"save"})])]),_:1},8,["onSubmit"])]),_:1}),l(D,{name:"view"},{default:o(()=>[e[10]||(e[10]=d("div",{class:"text-h6 q-mb-md"},"我的自訂字卡",-1)),s.customCards.length===0?(v(),T("div",fe,[l(K,{name:"info",size:"50px",color:"grey-5"}),e[8]||(e[8]=d("p",{class:"text-grey-7"},"還沒有自訂字卡",-1)),e[9]||(e[9]=d("p",{class:"text-grey-7"},"請切換到「新增字卡」頁籤來創建",-1))])):(v(),T("div",Ce,[l(h,{sentences:s.customCards},null,8,["sentences"])]))]),_:1}),l(D,{name:"manage"},{default:o(()=>[e[11]||(e[11]=d("div",{class:"text-h6 q-mb-md"},"管理自訂字卡",-1)),l(oe,{bordered:""},{default:o(()=>[(v(!0),T(_,null,x(s.customCards,(t,m)=>(v(),$(te,{key:m,clickable:""},{default:o(()=>[l(Z,null,{default:o(()=>[l(J,null,{default:o(()=>[E(O(t.english),1)]),_:2},1024),l(J,{caption:""},{default:o(()=>[E(O(t.chinese),1)]),_:2},1024)]),_:2},1024),l(Z,{side:""},{default:o(()=>[l(p,{flat:"",icon:"delete",color:"negative",onClick:b=>s.confirmDelete(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l(se,{modelValue:s.showDeleteDialog,"onUpdate:modelValue":e[6]||(e[6]=t=>s.showDeleteDialog=t)},{default:o(()=>[l(ee,null,{default:o(()=>[l(P,{class:"row items-center"},{default:o(()=>e[13]||(e[13]=[d("div",{class:"text-h6"},"確認刪除",-1)])),_:1}),l(P,null,{default:o(()=>e[14]||(e[14]=[E(" 確定要刪除這張字卡嗎？此操作無法復原。 ")])),_:1}),l(ae,{align:"right"},{default:o(()=>[w(l(p,{flat:"",label:"取消",color:"primary"},null,512),[[z]]),w(l(p,{flat:"",label:"刪除",color:"negative",onClick:s.deleteCard},null,8,["onClick"]),[[z]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Le=Y(me,[["render",ve],["__scopeId","data-v-6aed29ad"],["__file","CustomCardsPage.vue"]]);export{Le as default};
