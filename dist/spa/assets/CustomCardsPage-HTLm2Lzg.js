import{a as D,Q as R,c as T,b as H}from"./QTabPanels-DUBbNNL2.js";import{X as M,r as i,H as W,w as X,_ as Y,Y as G,Z as h,$ as O,a0 as o,a4 as d,a1 as l,ah as U,I as B,ax as $,a5 as g,ab as S,aa as K,ac as x,a8 as E,ad as q,ae as _,a2 as ee,a3 as J,aq as ae,a7 as se}from"./index-BevjMpM6.js";import{Q as le}from"./QForm-DXQT2siO.js";import{Q as P}from"./QItemLabel-BTHFIVCp.js";import{Q as te,a as Z}from"./QItem-ijq1b6iG.js";import{Q as oe}from"./QList-Bf0ryHau.js";import{Q as ne}from"./QPage-DOHZx5mX.js";import{C as z}from"./ClosePopup-Cd7r9ESc.js";import{F as ue}from"./FlashCard-CRhdpLAp.js";import{g as re,o as ie}from"./index-ea1a36e4-yErB6TnM.js";import"./index.esm2017-ClwH-SB1.js";import{g as de,r as j,a as ce,s as k}from"./index.esm2017-CFsHUG3Y.js";import"./QResizeObserver-BiQt9THO.js";import"./rtl-DFPa-2ov.js";import"./use-panel-CsbchcQC.js";import"./touch-BjYP5sR0.js";import"./selection-w1CSYTzs.js";const me=M({name:"CustomCardsPage",components:{FlashCard:ue},setup(){const s=i("create"),e=i([]),c=i([]),u=i({english:"",chinese:"",flipped:!1}),F=i(!1),p=i(-1),b=re(),t=de(),m=i(b.currentUser),w=i(!1),L=i(!1);W(()=>{w.value=!0,ie(b,async a=>{m.value=a,a?(console.log("user",a),console.log("user.uid",a.uid),await V(a.uid)):Q(),w.value=!1})}),X(m,async a=>{a?(console.log("newUser",a),console.log("newUser.uid",a.uid),await V(a.uid)):Q()});const Q=()=>{const a=localStorage.getItem("customCards");a&&(e.value=JSON.parse(a),c.value=Array(e.value.length).fill(!1))},V=async a=>{console.log("syncUserData",a);try{const n=localStorage.getItem("customCards"),r=n?JSON.parse(n):[],C=j(t,`users/${a}/customCards`),y=await ce(C),f=y.exists()?y.val():[];if(r.length>0&&f.length===0)await k(C,r),e.value=r;else if(r.length===0&&f.length>0)localStorage.setItem("customCards",JSON.stringify(f)),e.value=f;else if(r.length>0&&f.length>0){const v=[...f];for(const A of r)v.some(N=>N.english===A.english&&N.chinese===A.chinese)||v.push(A);await k(C,v),localStorage.setItem("customCards",JSON.stringify(v)),e.value=v}c.value=Array(e.value.length).fill(!1)}catch(n){console.error("同步用戶資料失敗:",n)}},I=async()=>{if(localStorage.setItem("customCards",JSON.stringify(e.value)),m.value)try{const a=j(t,`users/${m.value.uid}/customCards`);await k(a,e.value)}catch(a){console.error("保存到 Firebase 失敗:",a)}};return{activeTab:s,customCards:e,flippedCards:c,newCard:u,showDeleteDialog:F,currentUser:m,isLoading:w,synced:L,createCard:()=>{!u.value.english||!u.value.chinese||(e.value.push({english:u.value.english,chinese:u.value.chinese,flipped:!1}),c.value.push(!1),I(),u.value={english:"",chinese:"",flipped:!1},s.value="view")},flipCard:a=>{c.value[a]=!c.value[a]},confirmDelete:a=>{p.value=a,F.value=!0},deleteCard:()=>{if(p.value!==-1){const a=localStorage.getItem("en_love_arr"),n=JSON.parse(a||"[]"),r=e.value[p.value];if(r){const C=n.filter(y=>y.english!==r.english);localStorage.setItem("en_love_arr",JSON.stringify(C)),e.value.splice(p.value,1),c.value.splice(p.value,1),I()}}},speakText:(a,n="en-US")=>{if(a){const r=new SpeechSynthesisUtterance(a);r.lang=n,r.rate=.8,window.speechSynthesis.speak(r)}},autoTranslateZhToEn:async()=>{try{const n=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:u.value.chinese})})).json();console.log(n),u.value.english=n||"",console.log("newCard.value.english",u.value.english)}catch(a){console.error("翻譯失敗:",a)}},autoTranslateEnToZh:async()=>{try{const n=await(await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-en-to-zh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:u.value.english})})).json();console.log(n),u.value.chinese=n||"",console.log("newCard.value.chinese",u.value.chinese)}catch(a){console.error("翻譯失敗:",a)}}}}}),ge={class:"word-card-list"},pe={class:"row justify-between q-mt-lg"},fe={key:0,class:"text-center q-pa-lg"},Ce={key:1};function ve(s,e,c,u,F,p){const b=G("FlashCard");return h(),O(ne,{class:"q-pa-md"},{default:o(()=>[d("div",ge,[e[12]||(e[12]=d("h1",{class:"page-title"},"自訂字卡",-1)),l(R,{modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=t=>s.activeTab=t),class:"text-primary q-mb-lg"},{default:o(()=>[l(D,{name:"create",label:"新增字卡",icon:"add_circle"}),l(D,{name:"view",label:"我的字卡",icon:"list"}),l(D,{name:"manage",label:"管理字卡",icon:"settings"})]),_:1},8,["modelValue"]),l(H,{modelValue:s.activeTab,"onUpdate:modelValue":e[5]||(e[5]=t=>s.activeTab=t),animated:""},{default:o(()=>[l(T,{name:"create"},{default:o(()=>[e[7]||(e[7]=d("div",{class:"text-h6 q-mb-md"},"新增自訂字卡",-1)),l(le,{onSubmit:s.createCard,class:"q-gutter-md"},{default:o(()=>[l(U,{modelValue:s.newCard.english,"onUpdate:modelValue":e[1]||(e[1]=t=>s.newCard.english=t),label:"英文單字或句子",rules:[t=>!!t||"請輸入英文內容"],outlined:"",class:"large-input",type:"textarea"},null,8,["modelValue","rules"]),l(U,{modelValue:s.newCard.chinese,"onUpdate:modelValue":e[2]||(e[2]=t=>s.newCard.chinese=t),label:"中文翻譯",rules:[t=>!!t||"請輸入中文翻譯"],outlined:"",class:"large-input",type:"textarea"},null,8,["modelValue","rules"]),B(l(g,{class:"little-margin",icon:"language",label:"自動英翻中",color:"primary",onClick:s.autoTranslateEnToZh},null,8,["onClick"]),[[$,s.newCard.english&&!s.newCard.chinese]]),B(l(g,{class:"little-margin",icon:"language",label:"自動中翻英",color:"primary",onClick:s.autoTranslateZhToEn},null,8,["onClick"]),[[$,s.newCard.chinese&&!s.newCard.english]]),d("div",pe,[l(g,{class:"little-margin",icon:"volume_up",color:"secondary",label:"英文發音測試",onClick:e[3]||(e[3]=t=>s.speakText(s.newCard.english,"en-US")),disable:!s.newCard.english},null,8,["disable"]),l(g,{class:"little-margin",icon:"volume_up",color:"green-8",label:"中文發音測試",onClick:e[4]||(e[4]=t=>s.speakText(s.newCard.chinese,"zh-TW")),disable:!s.newCard.chinese},null,8,["disable"]),l(g,{class:"little-margin",type:"submit",color:"primary",label:"新增字卡",icon:"save"})])]),_:1},8,["onSubmit"])]),_:1}),l(T,{name:"view"},{default:o(()=>[e[10]||(e[10]=d("div",{class:"text-h6 q-mb-md"},"我的自訂字卡",-1)),s.customCards.length===0?(h(),S("div",fe,[l(K,{name:"info",size:"50px",color:"grey-5"}),e[8]||(e[8]=d("p",{class:"text-grey-7"},"還沒有自訂字卡",-1)),e[9]||(e[9]=d("p",{class:"text-grey-7"},"請切換到「新增字卡」頁籤來創建",-1))])):(h(),S("div",Ce,[l(b,{sentences:s.customCards},null,8,["sentences"])]))]),_:1}),l(T,{name:"manage"},{default:o(()=>[e[11]||(e[11]=d("div",{class:"text-h6 q-mb-md"},"管理自訂字卡",-1)),l(oe,{bordered:""},{default:o(()=>[(h(!0),S(_,null,x(s.customCards,(t,m)=>(h(),O(te,{key:m,clickable:""},{default:o(()=>[l(Z,null,{default:o(()=>[l(P,null,{default:o(()=>[E(q(t.english),1)]),_:2},1024),l(P,{caption:""},{default:o(()=>[E(q(t.chinese),1)]),_:2},1024)]),_:2},1024),l(Z,{side:""},{default:o(()=>[l(g,{flat:"",icon:"delete",color:"negative",onClick:w=>s.confirmDelete(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l(se,{modelValue:s.showDeleteDialog,"onUpdate:modelValue":e[6]||(e[6]=t=>s.showDeleteDialog=t)},{default:o(()=>[l(ee,null,{default:o(()=>[l(J,{class:"row items-center"},{default:o(()=>e[13]||(e[13]=[d("div",{class:"text-h6"},"確認刪除",-1)])),_:1}),l(J,null,{default:o(()=>e[14]||(e[14]=[E(" 確定要刪除這張字卡嗎？此操作無法復原。 ")])),_:1}),l(ae,{align:"right"},{default:o(()=>[B(l(g,{flat:"",label:"取消",color:"primary"},null,512),[[z]]),B(l(g,{flat:"",label:"刪除",color:"negative",onClick:s.deleteCard},null,8,["onClick"]),[[z]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Le=Y(me,[["render",ve],["__scopeId","data-v-f595a433"],["__file","CustomCardsPage.vue"]]);export{Le as default};
