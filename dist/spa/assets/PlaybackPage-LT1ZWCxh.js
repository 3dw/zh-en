import{c as A,u as j,k as O,b as q,h as _,d as C,j as V,X as F,r as m,_ as I,Z as l,$ as R,a0 as p,a4 as r,a1 as o,aa as U,a8 as P,ab as h,ad as f,a9 as w,a3 as z,ah as J,a5 as D,a2 as Q,ae as L,ac as M,af as Z}from"./index-Dy36b27O.js";import{Q as T}from"./QSpinnerDots-C3VMhSeN.js";import{Q as X}from"./QLinearProgress-BG9JEsrI.js";import{Q as G}from"./QImg-CQjrcZE1.js";import{Q as H}from"./QPage-DiUrNdKm.js";const K=A({name:"QBanner",props:{...j,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(e,{slots:n}){const{proxy:{$q:g}}=V(),y=O(e,g),c=q(()=>"q-banner row items-center"+(e.dense===!0?" q-banner--dense":"")+(y.value===!0?" q-banner--dark q-dark":"")+(e.rounded===!0?" rounded-borders":"")),v=q(()=>`q-banner__actions row items-center justify-end col-${e.inlineActions===!0?"auto":"all"}`);return()=>{const t=[_("div",{class:"q-banner__avatar col-auto row items-center self-start"},C(n.avatar)),_("div",{class:"q-banner__content col text-body2"},C(n.default))],d=C(n.action);return d!==void 0&&t.push(_("div",{class:v.value},d)),_("div",{class:c.value+(e.inlineActions===!1&&d!==void 0?" q-banner--top-padding":""),role:"alert"},t)}}}),W=F({name:"PlaybackPage",setup(){const e=m(""),n=m(""),g=m([]),y=m(!1),c=m(""),v=m(!1),t=m(""),d=async a=>{t.value="正在翻譯故事內容...";const s=await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-en-to-zh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:a})});if(!s.ok)throw new Error("翻譯失敗");const i=await s.text();return n.value=i,i},E=async a=>{t.value="正在分析故事情緒...";const s=await fetch("https://zh-en-backend.alearn13994229.workers.dev/emotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:a})});if(!s.ok)throw new Error("情緒分析失敗");return{emotions:((await s.json()).emotions||[]).map(u=>u?{name:(u.split(":")[0]||"").trim().replace(/^\d+\./,"")}:{name:""})}},B=async(a,s)=>{t.value=`正在生成 ${s} 的情緒圖片...`;const i=await fetch("https://zh-en-backend.alearn13994229.workers.dev/playback/image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story:a,emotion:s})});if(!i.ok)throw new Error("圖片生成失敗");return await i.json()},N=async a=>{t.value=`正在翻譯 ${a} 的英文說明...`;const s=await fetch("https://zh-en-backend.alearn13994229.workers.dev/translate-zh-to-en",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:`這個情緒是${a}`})});if(!s.ok)throw new Error("情緒翻譯失敗");return await s.text()},$=a=>{speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(a.enName);s.lang="en-US",s.rate=.8,speechSynthesis.speak(s)},x=async a=>{g.value=a.map(s=>({...s,showContent:!0,moveStep:0}))};return{userStory:e,translatedStory:n,emotions:g,loading:y,error:c,showProgress:v,progressMessage:t,analyzeEmotion:async()=>{if(!e.value.trim()){c.value="請輸入故事內容";return}y.value=!0,v.value=!0,c.value="";try{const a=e.value.trim(),s=await d(a),i=await E(s),b=[];for(const u of i.emotions){const k=await B(s,u.name);if(!k.images||!Array.isArray(k.images))throw new Error(`${u.name} 的圖片生成結果格式不正確`);const S=await N(u.name);b.push({name:u.name,enName:S,imageUrl:k.images[0]||"",isAnimating:!1,showContent:!1,moveStep:0})}await x(b)}catch(a){c.value=a instanceof Error?a.message:"分析過程發生錯誤，請稍後再試"}finally{y.value=!1,v.value=!1,t.value=""}},speakEmotion:$}}}),Y={class:"row items-center q-mb-md"},ee={class:"col"},te={key:0,class:"loading-section"},se={class:"text-subtitle1 q-mt-md"},ae={key:1,class:"error-section"},ne={key:2,class:"progress-section"},oe={class:"text-subtitle1 text-center"},re={class:"row q-col-gutter-md"},ie={class:"col-12 col-md-6"},le={class:"input-blob-container"},ce={class:"text-center"},de={key:0,class:"col-12 col-md-6"},ue={class:"emotion-grid"},me={key:0,class:"emotion-content"},pe={class:"text-subtitle1 q-mt-sm"};function he(e,n,g,y,c,v){return l(),R(H,{class:"q-pa-md"},{default:p(()=>[r("div",Y,[r("h1",ee,[o(U,{name:"psychology",size:"md",color:"primary",class:"q-mr-sm"}),n[1]||(n[1]=P(" 今日回顧 | Daily Reflection "))])]),e.loading?(l(),h("div",te,[o(T,{color:"primary",size:"3em"}),r("p",se,f(e.progressMessage),1)])):w("",!0),e.error?(l(),h("div",ae,[o(K,{class:"bg-negative text-white"},{default:p(()=>[P(f(e.error),1)]),_:1})])):w("",!0),e.showProgress?(l(),h("div",ne,[o(X,{indeterminate:"",rounded:"",size:"md",color:"primary",class:"q-mb-sm"}),r("div",oe,f(e.progressMessage),1)])):w("",!0),r("div",re,[r("div",ie,[o(Q,{class:"rpg-card"},{default:p(()=>[o(z,null,{default:p(()=>[n[2]||(n[2]=r("div",{class:"text-h6 q-mb-md"},"分享今天最深刻的經歷",-1)),r("div",le,[o(J,{modelValue:e.userStory,"onUpdate:modelValue":n[0]||(n[0]=t=>e.userStory=t),type:"textarea",rows:"6",placeholder:`請用英文或中文描述...
Please describe in English or Chinese...`,class:"custom-input"},null,8,["modelValue"])]),r("div",ce,[o(D,{color:"primary",label:"分析情緒",loading:e.loading,onClick:e.analyzeEmotion,class:"rpg-button"},{loading:p(()=>[o(T)]),_:1},8,["loading","onClick"])])]),_:1})]),_:1})]),e.emotions.length>0?(l(),h("div",de,[o(Q,{class:"rpg-card"},{default:p(()=>[o(z,null,{default:p(()=>[n[3]||(n[3]=r("div",{class:"text-h6 q-mb-md"},"情緒分析結果",-1)),r("div",ue,[(l(!0),h(L,null,M(e.emotions,(t,d)=>(l(),h("div",{key:d,class:Z(["emotion-item",{"move-step-1":t.moveStep===1,"move-step-2":t.moveStep===2,"show-content":t.showContent}])},[o(G,{src:t.imageUrl,"spinner-color":"primary",style:{height:"200px","max-width":"200px"},class:"rounded-borders"},null,8,["src"]),t.showContent?(l(),h("div",me,[r("div",pe,f(t.name)+" ("+f(t.enName)+") ",1),o(D,{flat:"",round:"",color:"primary",icon:"volume_up",onClick:E=>e.speakEmotion(t)},null,8,["onClick"])])):w("",!0)],2))),128))])]),_:1})]),_:1})])):w("",!0)])]),_:1})}const ke=I(W,[["render",he],["__scopeId","data-v-cb5522e8"],["__file","PlaybackPage.vue"]]);export{ke as default};
